var easy3d_plugins=function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=57)}([,function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));let n=0;class o{constructor(t,...e){this.object3d=null,Object.defineProperty(this,"id",{value:n++}),this.viewer=t,this.object3d=new o.easy3DAPI.THREE.Group}init(t){}update(t){}removeSelf(){}static install(t,e){return o.easy3DAPI=t,t.PluginManager.addPlugin(this.pluginName,this,e)}}o.easy3DAPI=window&&window.easy3d},function(t,e,i){"use strict";var n,o,s,r,a,l,h,c,p,u,d,f,v,g,m,w,y,_,b,x,M,P,C,A,S,k,O,B,D,z,E,V,T,L,j,I,R,U,F,H,N,G,q,W;i.d(e,"b",(function(){return n})),i.d(e,"g",(function(){return l})),i.d(e,"l",(function(){return c})),i.d(e,"i",(function(){return p})),i.d(e,"d",(function(){return d})),i.d(e,"a",(function(){return y})),i.d(e,"k",(function(){return A})),i.d(e,"f",(function(){return z})),i.d(e,"c",(function(){return T})),i.d(e,"h",(function(){return L})),i.d(e,"j",(function(){return j})),i.d(e,"e",(function(){return H})),i.d(e,"m",(function(){return N})),function(t){t.Perspective="perspective",t.Orthographic="orthographic"}(n||(n={})),function(t){t.OrbitControls="orbitControls",t.MapControls="mapControls"}(o||(o={})),function(t){t.Left="left",t.Right="right"}(s||(s={})),function(t){t.Front="front",t.Back="back",t.Double="double"}(r||(r={})),function(t){t.Popup2D="2D",t.Popup3D="3D",t.PopupDepth="depth"}(a||(a={})),function(t){t.Popup2D="2D",t.Popup3D="3D"}(l||(l={})),function(t){t.none="none",t.block="block"}(h||(h={})),function(t){t.Click="click",t.Dblclick="dblclick",t.Mousedown="mousedown",t.Mouseup="mouseup",t.Mouseover="mouseover",t.Mouseout="mouseout",t.Mouseenter="mouseenter",t.Mouseleave="mouseleave",t.Mousemove="mousemove",t.Contextmenu="contextmenu",t.Resize="resize",t.BgImgAdd="bgImgAdd",t.BeforeRender="beforeRender",t.AfterRender="afterRender",t.Add="add",t.Touchstart="touchstart",t.Touchmove="touchmove",t.Touchend="touchend"}(c||(c={})),function(t){t.Add="add",t.Loading="loading",t.Error="error",t.Cancel="cancel",t.TransformChange="transform_change"}(p||(p={})),function(t){t.DayNightCycle="cycle"}(u||(u={})),function(t){t.LinearNone="linearNone",t.QuadraticIn="quadraticIn",t.QuadraticOut="quadraticOut",t.QuadraticInOut="quadraticInOut",t.QuinticIn="quinticIn",t.QuinticOut="quinticOut",t.QuinticInOut="quinticInOut",t.CubicIn="cubicIn",t.CubicOut="cubicOut",t.CubicInOut="cubicInOut",t.QuarticIn="quarticIn",t.QuarticOut="quarticOut",t.QuarticInOut="quarticInOut",t.SinusoidalIn="sinusoidalIn",t.SinusoidalOut="sinusoidalOut",t.SinusoidalInOut="sinusoidalInOut",t.ExponentialIn="exponentialIn",t.ExponentialOut="exponentialOut",t.ExponentialInOut="exponentialInOut",t.CircularIn="circularIn",t.CircularOut="circularOut",t.CircularInOut="circularInOut",t.ElasticIn="elasticIn",t.ElasticOut="elasticOut",t.ElasticInOut="elasticInOut",t.BackIn="backIn",t.BackOut="backOut",t.BackInOut="backInOut",t.BounceIn="bounceIn",t.BounceOut="bounceOut",t.BounceInOut="bounceInOut"}(d||(d={})),function(t){t.Custom="custom",t.Model="model",t.Outline="outline",t.Uv="uv",t.Map="map"}(f||(f={})),function(t){t.Transform="transform",t.Custom="custom"}(v||(v={})),function(t){t.Stop="stop",t.Pause="pause",t.Resume="resume",t.Reset="reset"}(g||(g={})),function(t){t.Position="position",t.Center="center"}(m||(m={})),function(t){t.Grid="grid",t.Plane="plane"}(w||(w={})),function(t){t.X="x",t.Y="y",t.Z="z",t.Center="center"}(y||(y={})),function(t){t.Top="top",t.Bottom="bottom",t.Left="left",t.Right="right",t.Middle="middle",t.Front="front",t.Back="back"}(_||(_={})),function(t){t.RealTime="realTime",t.End="end",t.Discontinue="discontinue",t.StopPauseStart="stopPauseStart",t.StopPauseEnd="stopPauseEnd"}(b||(b={})),function(t){t.Play="play",t.Pause="pause",t.Discontinue="discontinue",t.RePlay="rePlay"}(x||(x={})),function(t){t.Add="add",t.Move="move",t.Delete="delete",t.Rename="rename"}(M||(M={})),function(t){t.x="x",t.y="y",t.z="z"}(P||(P={})),function(t){t.ReflectedWater="reflect",t.NoReflectedWater="noreflect"}(C||(C={})),function(t){t.Water="water",t.Flow="flow",t.Spread="spread"}(A||(A={})),function(t){t.NoToneMapping="None",t.LinearToneMapping="Linear",t.ACESFilmicToneMapping="ACESFilmic",t.ReinhardToneMapping="Reinhard",t.CineonToneMapping="Cineon",t.AgXToneMapping="AgX"}(S||(S={})),function(t){t.NoBlend="None",t.SoftLight="SoftLight",t.Screen="Screen"}(k||(k={})),function(t){t.Sunny="sunny",t.Cloudy="cloudy",t.Overcast="overcast",t.Rainy="rainy",t.Snowy="snowy"}(O||(O={})),function(t){t.U="u",t.V="v"}(B||(B={})),function(t){t.Blend="blend",t.Cutoff="cutoff",t.Opaque="opaque"}(D||(D={})),function(t){t.Points="Points",t.Mesh="Mesh"}(z||(z={})),function(t){t.NoBlending="NoBlending",t.NormalBlending="NormalBlending",t.AdditiveBlending="AdditiveBlending",t.SubtractiveBlending="SubtractiveBlending",t.MultiplyBlending="MultiplyBlending",t.CustomBlending="CustomBlending"}(E||(E={})),function(t){t.Time="time",t.Loop="loop"}(V||(V={})),function(t){t.Line="line",t.Point="point",t.Area="area"}(T||(T={})),function(t){t.Length="length",t.Area="area",t.Height="height"}(L||(L={})),function(t){t.Square="square",t.Circle="circle"}(j||(j={})),function(t){t[t.CUBE=1]="CUBE",t[t.SPHERE=2]="SPHERE"}(I||(I={})),function(t){t.Base="base",t.Dynamic="dynamic"}(R||(R={})),function(t){t.Play="play",t.Pause="pause",t.Replay="replay"}(U||(U={})),function(t){t[t.dichotomous=0]="dichotomous",t[t.monopodial=1]="monopodial"}(F||(F={})),function(t){t[t.Lateral=0]="Lateral",t[t.Axial=1]="Axial"}(H||(H={})),function(t){t.V="v",t.H="h"}(N||(N={})),function(t){t.lineOfX="lineOfX",t.lineOfY="lineOfY",t.lineOfZ="lineOfZ",t.circleShader="circleShader"}(G||(G={})),function(t){t.Extreme="extreme",t.High="high",t.Medium="medium",t.Low="low"}(q||(q={})),function(t){t.CameraStartMove="cameraStartMove",t.CameraMoving="cameraMoving",t.CameraStopMove="cameraStopMove"}(W||(W={}))},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,i){var n=i(12);function o(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,n(o.key),o)}}t.exports=function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){function i(e){return t.exports=i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},t.exports.__esModule=!0,t.exports.default=t.exports,i(e)}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports},,function(t,e,i){var n=i(15);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&n(t,e)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,i){var n=i(9).default,o=i(14);t.exports=function(t,e){if(e&&("object"===n(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return o(t)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){function i(e){return t.exports=i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,i(e)}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,i){var n=i(12);t.exports=function(t,e,i){return(e=n(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t},t.exports.__esModule=!0,t.exports.default=t.exports},,function(t,e,i){var n=i(9).default,o=i(13);t.exports=function(t){var e=o(t,"string");return"symbol"===n(e)?e:String(e)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,i){var n=i(9).default;t.exports=function(t,e){if("object"!==n(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){function i(e,n){return t.exports=i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},t.exports.__esModule=!0,t.exports.default=t.exports,i(e,n)}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports},,,,,,,,function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n},t.exports.__esModule=!0,t.exports.default=t.exports},,,,function(t,e,i){var n=i(23);t.exports=function(t,e){if(t){if("string"==typeof t)return n(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(t,e):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports},,,,,,,,,function(t,e,i){var n=i(39),o=i(40),s=i(27),r=i(41);t.exports=function(t){return n(t)||o(t)||s(t)||r()},t.exports.__esModule=!0,t.exports.default=t.exports},,,function(t,e,i){var n=i(23);t.exports=function(t){if(Array.isArray(t))return n(t)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},,,,,,,,,,,,,,,,function(t,e,i){"use strict";i.r(e),i.d(e,"UtilPlugins",(function(){return K}));var n=i(1),o=i(7),s=i.n(o),r=i(8),a=i.n(r),l=i(5),h=i.n(l),c=i(3),p=i.n(c),u=i(4),d=i.n(u);function f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=h()(t);if(e){var o=h()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return a()(this,i)}}var v=function(t){var e=function(){function e(){p()(this,e),this.pos=new t.Vector3,this.dir=new t.Vector3,this.right=new t.Vector3,this.up=new t.Vector3,this.dist=0,this.widthScale=1,this.sharp=!1}return d()(e,[{key:"lerpPathPoints",value:function(t,e,i){this.pos.lerpVectors(t.pos,e.pos,i),this.dir.lerpVectors(t.dir,e.dir,i),this.up.lerpVectors(t.up,e.up,i),this.right.lerpVectors(t.right,e.right,i),this.dist=(e.dist-t.dist)*i+t.dist,this.widthScale=(e.widthScale-t.widthScale)*i+t.widthScale}},{key:"copy",value:function(t){this.pos.copy(t.pos),this.dir.copy(t.dir),this.up.copy(t.up),this.right.copy(t.right),this.dist=t.dist,this.widthScale=t.widthScale}}]),e}(),i=new t.Vector3,n=new t.Vector3,o=new t.Vector3,r=new t.Matrix4,a=new t.QuadraticBezierCurve3;var l=function(){function s(){p()(this,s),this.array=[],this.count=0}return d()(s,[{key:"set",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if((e=e.slice(0)).length<2)return console.warn("PathPointList: points length less than 2."),void(this.count=0);s&&!e[0].equals(e[e.length-1])&&e.push((new t.Vector3).copy(e[0]));for(var r=0,a=e.length;r<a;r++)if(0===r)this._start(e[r],e[r+1],o);else if(r===a-1)if(s){this._corner(e[r],e[1],i,n,o);var l=this.array[0].dist;this.array[0].copy(this.array[this.count-1]),this.array[0].dist=l}else this._end(e[r]);else this._corner(e[r],e[r+1],i,n,o)}},{key:"distance",value:function(){return this.count>0?this.array[this.count-1].dist:0}},{key:"_getByIndex",value:function(t){return this.array[t]||(this.array[t]=new e),this.array[t]}},{key:"_start",value:function(t,e,i){this.count=0;var n=this._getByIndex(this.count);if(n.pos.copy(t),n.dir.subVectors(e,t),i)n.up.copy(i);else{var o=Number.MAX_VALUE,s=Math.abs(n.dir.x),r=Math.abs(n.dir.y),a=Math.abs(n.dir.z);s<o&&(o=s,n.up.set(1,0,0)),r<o&&(o=r,n.up.set(0,1,0)),a<o&&n.up.set(0,0,1)}n.right.crossVectors(n.dir,n.up).normalize(),n.up.crossVectors(n.right,n.dir).normalize(),n.dist=0,n.widthScale=1,n.sharp=!1,n.dir.normalize(),this.count++}},{key:"_end",value:function(t){var e=this.array[this.count-1],n=this._getByIndex(this.count);n.pos.copy(t),n.dir.subVectors(t,e.pos);var o=n.dir.length();n.dir.normalize(),n.up.copy(e.up);var s=i.crossVectors(e.dir,n.dir);if(s.length()>Number.EPSILON){s.normalize();var a=Math.acos(Math.min(Math.max(e.dir.dot(n.dir),-1),1));n.up.applyMatrix4(r.makeRotationAxis(s,a))}n.right.crossVectors(n.dir,n.up).normalize(),n.dist=e.dist+o,n.widthScale=1,n.sharp=!1,this.count++}},{key:"_corner",value:function(t,e,o,s,r){if(o>0&&s>0){for(var l=function(t,e,o,s,r,a){var l=i.subVectors(e,t),h=n.subVectors(o,e),c=l.length(),p=h.length();l.normalize(),h.normalize();var u=Math.min(.999999*(r?c/2:c),s);a.v0.copy(e).sub(l.multiplyScalar(u)),a.v1.copy(e);var d=Math.min(p/2*.999999,s);return a.v2.copy(e).add(h.multiplyScalar(d)),a}(this.array[this.count-1].pos,t,e,o,this.count-1==0,a).getPoints(s),h=0;h<s;h++)this._sharpCorner(l[h],l[h+1],r,0===h?1:0);l[s].equals(e)||this._sharpCorner(l[s],e,r,2)}else this._sharpCorner(t,e,r,0,!0)}},{key:"_sharpCorner",value:function(t,e,s){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=this.array[this.count-1],c=this._getByIndex(this.count),p=i.subVectors(t,h.pos),u=n.subVectors(e,t),d=p.length();if(p.normalize(),u.normalize(),c.pos.copy(t),1===a?c.dir.copy(p):2===a?c.dir.copy(u):(c.dir.addVectors(p,u),c.dir.normalize()),s)1===c.dir.dot(s)?c.right.crossVectors(u,s).normalize():c.right.crossVectors(c.dir,s).normalize(),c.up.crossVectors(c.right,c.dir).normalize();else{c.up.copy(h.up);var f=o.crossVectors(h.dir,c.dir);if(f.length()>Number.EPSILON){f.normalize();var v=Math.acos(Math.min(Math.max(h.dir.dot(c.dir),-1),1));c.up.applyMatrix4(r.makeRotationAxis(f,v))}c.right.crossVectors(c.dir,c.up).normalize()}c.dist=h.dist+d;var g=p.dot(u);c.widthScale=Math.min(1/Math.sqrt((1+g)/2),1.415)||1,c.sharp=Math.abs(g-1)>.05&&l,this.count++}}]),s}();function h(i,n){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=n.width||.1,r=void 0!==n.progress?n.progress:1,a=void 0===n.arrow||n.arrow,l=void 0!==n.side?n.side:"both",h=s/2,c="both"!==l?s/2:s,p=i.distance(),u=r*p;if(0==p)return null;var d=h/c,f=h/p,v=0,g=[],m=[],w=[],y=[],_=[],b=0,x=new t.Vector3,M=new t.Vector3,P=new t.Vector3,C=new t.Vector3,A=new t.Vector3,S=new t.Vector3;function k(t){var e=0===g.length,i=t.sharp&&!e,n=t.dist/c,s=t.dist/p,r=t.dir,a=t.up,u=t.right;if("left"!==l?x.copy(u).multiplyScalar(h*t.widthScale):x.set(0,0,0),"right"!==l?M.copy(u).multiplyScalar(-h*t.widthScale):M.set(0,0,0),x.add(t.pos),M.add(t.pos),i){P.fromArray(g,g.length-6).sub(M),C.fromArray(g,g.length-3).sub(x);var k,O,B=P.length()-C.length();B>0?(k=P,O=M):(k=C,O=x),A.copy(k).setLength(Math.abs(B)).add(O);var D=S.copy(O).sub(A).normalize().dot(r)*S.copy(O).sub(A).length()*2;S.copy(r).setLength(D).add(A),B>0?(g.push(A.x,A.y,A.z,x.x,x.y,x.z,M.x,M.y,M.z,x.x,x.y,x.z,S.x,S.y,S.z,x.x,x.y,x.z),b+=6,_.push(b-6,b-8,b-7,b-6,b-7,b-5,b-4,b-6,b-5,b-2,b-4,b-1),v+=12):(g.push(M.x,M.y,M.z,A.x,A.y,A.z,M.x,M.y,M.z,x.x,x.y,x.z,M.x,M.y,M.z,S.x,S.y,S.z),b+=6,_.push(b-6,b-8,b-7,b-6,b-7,b-5,b-6,b-5,b-3,b-2,b-3,b-1),v+=12),m.push(a.x,a.y,a.z,a.x,a.y,a.z,a.x,a.y,a.z,a.x,a.y,a.z,a.x,a.y,a.z,a.x,a.y,a.z),w.push(n-d,0,n-d,1,n,0,n,1,n+d,0,n+d,1),o&&y.push(s-f,0,s-f,1,s,0,s,1,s+f,0,s+f,1)}else g.push(M.x,M.y,M.z,x.x,x.y,x.z),m.push(a.x,a.y,a.z,a.x,a.y,a.z),w.push(n,0,n,1),o&&y.push(s,0,s,1),b+=2,e||(_.push(b-2,b-4,b-3,b-2,b-3,b-1),v+=6)}var O,B=new t.Vector3;function D(t){var e=t.dir,i=t.up,n=t.right,r=t.dist/c,a=t.dist/p;"left"!==l?x.copy(n).multiplyScalar(2*h):x.set(0,0,0),"right"!==l?M.copy(n).multiplyScalar(2*-h):M.set(0,0,0),B.copy(e).setLength(3*h),x.add(t.pos),M.add(t.pos),B.add(t.pos),g.push(M.x,M.y,M.z,x.x,x.y,x.z,B.x,B.y,B.z),m.push(i.x,i.y,i.z,i.x,i.y,i.z,i.x,i.y,i.z),w.push(r,"both"!==l?"right"!==l?-2:0:-.5,r,"both"!==l?"left"!==l?2:0:1.5,r+1.5,"both"!==l?0:.5),o&&y.push(a,"both"!==l?"right"!==l?-2:0:-.5,a,"both"!==l?"left"!==l?2:0:1.5,a+1.5*s/p,"both"!==l?0:.5),b+=3,_.push(b-1,b-3,b-2),v+=3}if(u>0)for(var z=0;z<i.count;z++){var E=i.array[z];if(E.dist>u){var V=i.array[z-1];O=new e;var T=(u-V.dist)/(E.dist-V.dist);O.lerpPathPoints(V,E,T),k(O);break}k(E)}else O=i.array[0];return a&&D(O=O||i.array[i.count-1]),{position:g,normal:m,uv:w,uv2:y,indices:_,count:v}}return{PathGeometry:function(e){s()(n,e);var i=f(n);function n(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return p()(this,n),t=i.call(this),isNaN(e)?t._initByData(e.pathPointList,e.options,e.usage,o):t._initByMaxVertex(e,o),t}return d()(n,[{key:"_initByMaxVertex",value:function(e,i){this.setAttribute("position",new t.BufferAttribute(new Float32Array(3*e),3).setUsage(t.DynamicDrawUsage)),this.setAttribute("normal",new t.BufferAttribute(new Float32Array(3*e),3).setUsage(t.DynamicDrawUsage)),this.setAttribute("uv",new t.BufferAttribute(new Float32Array(2*e),2).setUsage(t.DynamicDrawUsage)),i&&this.setAttribute("uv2",new t.BufferAttribute(new Float32Array(2*e),2).setUsage(t.DynamicDrawUsage)),this.drawRange.start=0,this.drawRange.count=0,this.setIndex(e>65536?new t.Uint32BufferAttribute(3*e,1):new t.Uint16BufferAttribute(3*e,1))}},{key:"_initByData",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,s=h(e,i,o);s&&0!==s.count?(this.setAttribute("position",new t.BufferAttribute(new Float32Array(s.position),3).setUsage(n||t.StaticDrawUsage)),this.setAttribute("normal",new t.BufferAttribute(new Float32Array(s.normal),3).setUsage(n||t.StaticDrawUsage)),this.setAttribute("uv",new t.BufferAttribute(new Float32Array(s.uv),2).setUsage(n||t.StaticDrawUsage)),o&&this.setAttribute("uv2",new t.BufferAttribute(new Float32Array(s.uv2),2).setUsage(n||t.StaticDrawUsage)),this.setIndex(s.position.length/3>65536?new t.Uint32BufferAttribute(s.indices,1):new t.Uint16BufferAttribute(s.indices,1))):this._initByMaxVertex(2,o)}},{key:"update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=!!this.getAttribute("uv2"),n=h(t,e,i);n?(this._updateAttributes(n.position,n.normal,n.uv,i?n.uv2:null,n.indices),this.drawRange.count=n.count):this.drawRange.count=0}},{key:"_resizeAttribute",value:function(e,i){for(var n=this.getAttribute(e);n.array.length<i;){var o=n.array.length,s=new t.BufferAttribute(new Float32Array(2*o),n.itemSize,n.normalized);s.name=n.name,s.usage=n.usage,this.setAttribute(e,s),n=s}}},{key:"_resizeIndex",value:function(e){for(var i=this.getIndex();i.array.length<e;){var n=i.array.length,o=new t.BufferAttribute(2*n>65535?new Uint32Array(2*n):new Uint16Array(2*n),1);o.name=i.name,o.usage=i.usage,this.setIndex(o),i=o}}},{key:"_updateAttributes",value:function(t,e,i,n,o){this._resizeAttribute("position",t.length);var s=this.getAttribute("position");s.array.set(t,0),s.updateRange.count=t.length,s.needsUpdate=!0,this._resizeAttribute("normal",e.length);var r=this.getAttribute("normal");r.array.set(e,0),r.updateRange.count=e.length,r.needsUpdate=!0,this._resizeAttribute("uv",i.length);var a=this.getAttribute("uv");if(a.array.set(i,0),a.updateRange.count=i.length,a.needsUpdate=!0,n){this._resizeAttribute("uv2",n.length);var l=this.getAttribute("uv2");l.array.set(n,0),l.updateRange.count=n.length,l.needsUpdate=!0}this._resizeIndex(o.length);var h=this.getIndex();h.set(o,0),h.updateRange.count=o.length,h.needsUpdate=!0}}]),n}(t.BufferGeometry),PathPointList:l,PathPoint:e}},g=i(2);const m=t=>{const{THREE:e,BaseObject:i,BaseTool:n,Base:o,Model:s,ObjectManager:r}=t;return class{constructor(t,o,a){this._viewer=t,this.objects=[],this._points=[];const l=v(e).PathPointList;this._pathPointsList=new l,this._xVec=new e.Vector3(1,0,0),this._yVec=new e.Vector3(0,1,0),this._zVec=new e.Vector3(0,0,1),this._first=!0,this.dbClick=!1,this.finished=!1,this._options=o,this._callback=a,o&&o.target&&((o.target instanceof s||o.target instanceof i||o.target instanceof e.Object3D)&&(this.initModel=o.target),(n.Validator.isNumber(o.target)||n.Validator.isString(o.target))&&r.Instance.hasBaseObj(o.target)&&(this.initModel=r.Instance.getBaseObj(o.target))),this._movekHandlerCb=t=>{t&&t.intersect&&(this.updatePath(t,this._options),this.modelsInfos=this.cloneModelsUpdate({}),this._callback&&this._callback(this.modelsInfos))},this._dblClickHandlerCb=()=>{this._viewer.off(g.l.Mousemove,this._movekHandlerCb),this.modelsInfos=this.cloneModelsUpdate({}),this.dbClick=!0},this.modelPlane(),this.startBatchCopy(this._options)}startBatchCopy(t){this._initModelInfos=this.initModelInfo(this.initModel);let e=this.initPathPara(this._initModelInfos.boxBottomPos,t);this._plane.position.set(0,this._initModelInfos.boxBottomHei,0),this._path=this.creatPath(e.data,e.material),this._viewer.on(g.l.Mousemove,this._movekHandlerCb,{target:[this._plane]}),this._viewer.on(g.l.Dblclick,this._dblClickHandlerCb)}modelPlane(){let t=this._viewer.camera.object3d.far;const i=new e.PlaneGeometry(t,t);i.rotateX(-Math.PI/2),this._plane=new e.Mesh(i,new e.MeshBasicMaterial({visible:!1})),this._plane.position.set(0,0,0),this._viewer.add(this._plane)}initPathPara(t,e){this._points[0]=t,this._points[1]=t,n.Validator.isNumber(e.opacity)||(e.opacity=.9);let i="white";return(n.Validator.isNumber(e.color)||n.Validator.isString(e.color))&&(i=e.color),{data:{points:this._points,width:e.width?e.width:1},material:{map:e.map,color:i,opacity:e.opacity,side:"double",mapRepeat:e.mapRepeat||[1,1],mapTransparent:!!e.mapTransparent&&e.mapTransparent}}}creatPath(t,i){let n,s=Object.assign({},{up:[0,1,0],close:!1,width:1,position:[0,0,0],scale:[1,1,1],isAdd:!0,type:"Path",points:[]},t),r=s.points.map(t=>(new e.Vector3).fromArray(t));const a=new(0,v(e).PathPointList),l=new e.Vector3;l.fromArray(s.up),a.set(r,s.cornerRadius,s.cornerSplit,l,s.close);const h=new(0,v(e).PathGeometry);h.update(a,{width:s.width,arrow:!1,progress:1}),i instanceof e.MeshStandardMaterial?n=i:(n=o.standardMaterial(i),n.flatShading=!0);let c=new e.Mesh(h,n);return c.frustumCulled=!1,this._viewer.add(c),c}updatePath(t,i){this._points[1]=t.intersect.point.toArray();let n,o,s=this._points.map(t=>(new e.Vector3).fromArray(t));this._pathPointsList.set(s),i.map?(n=10*i.width,o=!1):(n=i.width,o=!0),this._path.geometry.update(this._pathPointsList,{width:n,arrow:o})}initModelInfo(t){let i=t,n=i.object3d.position,o=(new e.Box3).setFromObject(i.object3d,!0),s=o.max.x-o.min.x,r=o.max.z-o.min.z;this._initRotation=Array.from(i.objRotation),this._initRotationForTrans=i.objRotation;let a=o.min.x+s/2,l=o.min.y;return{mdLen:s,mdWid:r,mdPos:n,boxBottomHei:l,boxBottomPos:[a,l,o.min.z+r/2]}}stopBatchClone(){for(this._viewer.off(g.l.Mousemove,this._movekHandlerCb),this._viewer.remove(this._path,!0),this._viewer.remove(this._plane,!0),this.objects.map((t,e,i)=>{this._viewer.remove(t)});this.objects.length>0;)this.objects.pop();this.initModel&&this.initModel.transform({rotation:this._initRotation}),this._first=!0,this.finishBatchClone()}cloneModelsUpdate(t){let o,r,a,l=new e.Vector3,h=new e.Vector3;l.fromArray(this._points[0]),h.fromArray(this._points[1]);let c=h.sub(l),p=c.length();if(n.Validator.isNumber(t.specifyAngle)?(a=t.specifyAngle,this._initRotationForTrans[1]=t.specifyAngle):a=this._initRotationForTrans[1],!t.specifySpacing&&!t.specifyCount){let t=Math.max(this._initModelInfos.mdLen,this._initModelInfos.mdWid);t<1&&(o=1),t>=1&&this._initModelInfos.mdLen!==this._initModelInfos.mdWid&&(o=2.028+1.027*(t-1)),t>=1&&this._initModelInfos.mdLen===this._initModelInfos.mdWid&&(o=2.041+1.041*(t-1)),r=Math.floor(p/o)}if(t.specifySpacing&&(o=t.specifySpacing,r=Math.floor(p/o)),t.specifyCount&&(r=t.specifyCount,o=Number((p/r).toFixed(3))),t.specifyCount&&t.specifySpacing)return void console.warn("“间距”和“个数”参数两者仅可取一！");let u=c.angleTo(this._xVec),d=c.angleTo(this._yVec),f=c.angleTo(this._zVec);if(this._first){this._oldCount=r;for(let t=0;t<r;t++){let t;this.initModel instanceof s?t=this.initModel.clone({scale:[this.initModel.object3d.scale.x/this.initModel.relativeTransform.scale[0],this.initModel.object3d.scale.y/this.initModel.relativeTransform.scale[1],this.initModel.object3d.scale.z/this.initModel.relativeTransform.scale[2]]}):(this.initModel instanceof i||this.initModel instanceof e.Object3D)&&(t=this.initModel.clone()),this.objects.push(t)}this._first=!1;let t=o;this.objects.map((e,i,n)=>{t=o*(i+1);let s=t*Math.cos(u)+this._initModelInfos.mdPos.x,r=t*Math.cos(d)+this._initModelInfos.mdPos.y,a=t*Math.cos(f)+this._initModelInfos.mdPos.z;e.transform({position:[s,r,a]})})}else if(this._newCount=r,this._newCount>this.objects.length){let t=this._newCount-this.objects.length;for(let n=0;n<t;n++){let t;this.initModel instanceof s?t=this.initModel.clone({scale:[this.initModel.object3d.scale.x/this.initModel.relativeTransform.scale[0],this.initModel.object3d.scale.y/this.initModel.relativeTransform.scale[1],this.initModel.object3d.scale.z/this.initModel.relativeTransform.scale[2]]}):(this.initModel instanceof i||this.initModel instanceof e.Object3D)&&(t=this.initModel.clone()),this.objects.push(t)}let n=o;this.objects.map((t,e,i)=>{n=o*(e+1);let s=n*Math.cos(u)+this._initModelInfos.mdPos.x,r=n*Math.cos(d)+this._initModelInfos.mdPos.y,a=n*Math.cos(f)+this._initModelInfos.mdPos.z;t.transform({position:[s,r,a],rotation:this._initRotationForTrans}),t.configVisible(!0,void 0)}),this.initModel.transform({rotation:this._initRotationForTrans}),this._oldCount=r}else if(this._newCount=r,this._newCount<=this._oldCount){let t=o;this.objects.map((e,i,n)=>{t=o*(i+1);let s=t*Math.cos(u)+this._initModelInfos.mdPos.x,r=t*Math.cos(d)+this._initModelInfos.mdPos.y,a=t*Math.cos(f)+this._initModelInfos.mdPos.z;e.transform({position:[s,r,a],rotation:this._initRotationForTrans}),this._newCount<=i&&i<this._oldCount&&e.configVisible(!1,void 0)}),this.initModel.transform({rotation:this._initRotationForTrans}),this._oldCount=r}else{let t=o;this.objects.map((e,i,n)=>{t=o*(i+1);let s=t*Math.cos(u)+this._initModelInfos.mdPos.x,r=t*Math.cos(d)+this._initModelInfos.mdPos.y,a=t*Math.cos(f)+this._initModelInfos.mdPos.z;e.transform({position:[s,r,a],rotation:this._initRotationForTrans}),this._oldCount<=i&&i<this._newCount&&e.configVisible(!0,void 0)}),this.initModel.transform({rotation:this._initRotationForTrans}),this._oldCount=r}return this.finalCount=this._newCount,{spacing:o,count:r,angle:a}}finishBatchClone(){for(this._viewer.remove(this._path,!0),this._viewer.remove(this._plane,!0),this.objects.map((t,e,i)=>{e>=this._newCount&&this._viewer.remove(t)});this.objects.length>0;)this.objects.pop();this._viewer.off(g.l.Mousemove,this._movekHandlerCb),this._viewer.off(g.l.Dblclick,this._dblClickHandlerCb),this.finished=!0,this.objects=[],this._points=[],this._pathPointsList=null,this._plane=null,this._path=null,this._initModelInfos=null,this._oldCount=null,this._newCount=null,this._xVec=null,this._yVec=null,this._zVec=null,this.initModel=null,this._options=null,this._initRotation=[],this.modelsInfos=null}}};class w extends n.a{constructor(t){super(t),this.engineVersion="3.0.1",this.version="0.01"}batchCopy(t,e,i){let o=m(n.a.easy3DAPI);return void 0===this.batchCopyObject||null==this.batchCopyObject||this.batchCopyObject.finished?(this.batchCopyObject=new o(t,e,i),this.batchCopyObject):(console.warn("批量复制未完成！"),this.batchCopyObject)}cloneModelsUpdate(t){const{BaseTool:e}=n.a.easy3DAPI;let i;return e.Validator.isNumber(t.specifyAngle)?(t.specifySpacing=this.batchCopyObject.modelsInfos.spacing,i=this.batchCopyObject.cloneModelsUpdate(t),this.batchCopyObject.modelsInfos=i):(i=this.batchCopyObject.cloneModelsUpdate(t),this.batchCopyObject.modelsInfos=i),i}stopBatchClone(){this.batchCopyObject&&this.batchCopyObject.stopBatchClone()}finishBatchClone(){let t=this.batchCopyObject.modelsInfos;for(;this.batchCopyObject.objects.length>this.batchCopyObject.finalCount;)this.batchCopyObject.objects.pop();let e=Array.from(this.batchCopyObject.objects);return e.unshift(this.batchCopyObject.initModel),this.batchCopyObject.finishBatchClone(),this.batchCopyObject=null,{modelsInfos:t,models:e}}static create(t){return w.instance||(w.instance=new w(t)),w.instance}}w.pluginName="BatchCopy",w.instance=null;var y=w,_=function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function r(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((n=n.apply(t,e||[])).next())}))};const b=t=>{const{BaseObject:e,THREE:i,BaseTool:n,MaterialConfig:o}=t;return class extends e{constructor(t,e,o){if(super(e=Object.assign({},{position:[0,0,0],scale:1,rotation:[0,0,0],isAdd:!0,visible:!0,opacity:.5,width:10,type:"ReferenceMap"},e)),this.options=e,this._viewer=t,this._callback=o,n.Validator.isString(e.map)&&!n.Validator.isNullString(e.map))this.createReferenceMap(e);else{const t=new i.MeshBasicMaterial({color:16777215,opacity:e.opacity,transparent:!0}),n=new i.PlaneGeometry(e.width,e.width);n.lookAt(new i.Vector3(0,1,0));const o=new i.Mesh(n,t);if(o.position.set(0,.01,0),this.object3d=o,this.object3d.uuid=this.id,this.configVisible(!1),this.transform({position:e.position,scale:[e.scale,e.scale,e.scale],rotation:e.rotation}),!0===e.isAdd){this._viewer.add(this)}else this.target=this._viewer.id;this._callback&&this._callback(this)}}createReferenceMap(t){return _(this,void 0,void 0,(function*(){let e,s=this;e=yield o.loadTexture(t.map),e.colorSpace=i.SRGBColorSpace;const r=new i.MeshBasicMaterial({color:16777215,map:e,opacity:t.opacity,transparent:!0});let a=e.source.data.width,l=e.source.data.height;const h=new i.PlaneGeometry(t.width,t.width*l/a);h.lookAt(new i.Vector3(0,1,0));const c=new i.Mesh(h,r);if(c.position.set(0,.01,0),this.object3d=c,this.object3d.uuid=this.id,n.Validator.isBoolean(t.visible)&&this.configVisible(t.visible),this.transform({position:t.position,scale:[t.scale,t.scale,t.scale],rotation:t.rotation}),!0===t.isAdd){this._viewer.add(this)}else this.target=this._viewer.id;s._callback&&s._callback(s)}))}_swichReferenceMap(t){return _(this,void 0,void 0,(function*(){let e=yield o.loadTexture(t),n=e.source.data.width,s=e.source.data.height;const r=this.object3d;r.geometry=new i.PlaneGeometry(this.options.width,this.options.width*s/n),r.scale.set(this.options.scale,this.options.scale,this.options.scale),r.geometry.lookAt(new i.Vector3(0,1,0)),r.material.map=e,r.visible=this.options.visible}))}configReferenceMap(t){if(n.Validator.isValidObject(t)){if(this.options=Object.assign({},this.options,t),n.ArrayUtil.isFixedTypeArray(t.position,3,"number")&&this.transform({position:t.position}),n.Validator.isBoolean(t.visible)){const e=this.object3d;if(n.Validator.isNull(e.material.map))return;this.configVisible(t.visible)}if(n.ArrayUtil.isFixedTypeArray(t.rotation,3,"number")&&this.transform({rotation:t.rotation}),n.Validator.isNumber(t.scale)&&this.transform({scale:[t.scale,t.scale,t.scale]}),n.Validator.isNumber(t.opacity)){this.object3d.material.opacity=t.opacity}n.Validator.isString(t.map)&&this._swichReferenceMap(t.map)}}_dispose(){super._dispose(),this._viewer=null}}};class x extends n.a{constructor(t){super(t),this.engineVersion="3.0.1",this.version="0.01"}referenceMap(t,e,i){let o=b(n.a.easy3DAPI);return this.referenceMapObject=new o(t,e,i),this.referenceMapObject}configReferenceMap(t,e){const{ObjectManager:i,BaseTool:o}=n.a.easy3DAPI;if(i.Instance.hasBaseObj(t)){const n=i.Instance.getBaseObj(t);return o.Validator.isValidObject(e)?n.configReferenceMap(e):n.configReferenceMap(null)}return null}removeSelf(t){this.referenceMapObject&&(this.referenceMapObject.removeSelf(t),this.referenceMapObject=null)}static create(t){return x.instance||(x.instance=new x(t)),x.instance}}x.pluginName="ReferenceMap",x.instance=null;var M=x;class P extends n.a{constructor(t,e){super(t),this.engineVersion="3.0.1",this.version="0.01";const{THREE:i}=n.a.easy3DAPI;this.box=new i.Box3,this.tolerance=1,this.sensitivity=200,this.fullMatch=!1,this.lineColor=new i.Color("#ff00ff"),this.logEnable=!1,this.enable=!0}init(){this._modelEventCb=t=>{this._updateAABB(t.target)},this._viewerEventCb=t=>{const{ObjectManager:e,Model:i,Util:o}=n.a.easy3DAPI;let s=e.Instance.getBaseObjByViewer(t.target);this.modelsArray=s.filter(t=>t instanceof i),o.configTransformControl({target:this.modelsArray}),this.modelsArray.forEach(t=>{this._updateAABB(t),t.on(g.i.TransformChange,this._modelEventCb)})},this.viewer.add(this.object3d),this.viewer.on(g.l.Add,this._viewerEventCb)}_updateAABB(t){var e;const i=null!==(e=t.object3d.userData)&&void 0!==e?e:{};this.box.makeEmpty(),this.box.setFromObject(t.object3d),i.aabb=this.box.clone()}_filter(t){const{Model:e}=n.a.easy3DAPI;return!t.object3d.visible||!(t instanceof e)&&void 0}_isIgnored(t,e){return t.id===e.id||this._filter(e)}_log(...t){this.logEnable&&console.log(...t)}_draw(t,e){const{THREE:i}=n.a.easy3DAPI;let o=e?this.vertical:this.horizontal;if(o){o.visible=!0;const e=o.geometry.getAttribute("position");e.set(t),e.needsUpdate=!0}else{const n=new i.Float32BufferAttribute(t,3);n.setUsage(i.DynamicDrawUsage);const s=new i.BufferGeometry;s.setAttribute("position",n),o=new i.Line(s,new i.LineBasicMaterial({color:this.lineColor,transparent:!0,depthWrite:!1,depthTest:!1})),e?this.vertical=o:this.horizontal=o,this.viewer.add(o)}}_drawLine({verticalLeft:t,verticalDepth:e,verticalStart:i,horizontalDepth:n,horizontalLeft:o,horizontalStart:s}){if(t){let n=[t,i.y,e,...i.toArray()];this._draw(n,!0)}else this.vertical&&(this.vertical.visible=!1);if(n){const t=[o,s.y,n,...s.toArray()];this._draw(t,!1)}else this.horizontal&&(this.horizontal.visible=!1)}_adsorb(){const{Util:t}=n.a.easy3DAPI;t.configTransformControl({enabled:!1}),setTimeout(()=>{t.configTransformControl({enabled:!0})},this.sensitivity)}_fullMatchCompute({verticalLeft:t,verticalDepth:e,verticalStart:i,horizontalDepth:o,horizontalLeft:s,horizontalStart:r,verticalFix:a,horizontalFix:l,nodeCenter:h}){const{THREE:c}=n.a.easy3DAPI;if(this.fullMatch){let n=1/0,p=-1/0,u=1/0,d=-1/0;if(null!==t||null!==o){for(let e=0,i=this.modelsArray.length;e<i;e++){const i=this.modelsArray[e].userData.aabb,s=i.getCenter(new c.Vector3),r=i.min,h=i.max;.5===a&&t===s.x?(n=Math.min(n,s.z),p=Math.max(p,s.z)):t!==r.x&&t!==h.x||(n=Math.min(n,r.z,h.z),p=Math.max(p,r.z,h.z)),.5===l&&o===s.z?(u=Math.min(u,s.x),d=Math.max(d,s.x)):o!==h.z&&o!==r.z||(u=Math.min(u,h.x,r.x),d=Math.max(d,h.x,r.x))}n=Math.min(n,h.z),p=Math.max(p,h.z),u=Math.min(u,h.x),d=Math.max(d,h.x)}n!==1/0&&p!==-1/0&&(e=n,i.z=p),u!==1/0&&d!==-1/0&&(s=d,r.x=u)}return{verticalLeft:t,verticalDepth:e,verticalStart:i,horizontalDepth:o,horizontalLeft:s,horizontalStart:r}}_findAlign(t){const{THREE:e}=n.a.easy3DAPI;this._updateAABB(t);const i=t.object3d.userData.aabb,o=i.getCenter(new e.Vector3),s=i.getSize(new e.Vector3),r=i.min,a=i.max,l=this.tolerance||0;let h=null,c=null,p=null,u=null,d=null,f=null;this.modelsArray.some(i=>{if(this._isIgnored(t,i))return!1;const n=i.object3d.userData.aabb,v=n.getCenter(new e.Vector3),g=n.min,m=n.max;return null==h&&(Math.abs(v.x-o.x)<=l?(h=v.x,d=.5,this._log("纵向居中对齐")):Math.abs(g.x-r.x)<=l?(h=g.x,d=0,this._log("左边对齐")):Math.abs(g.x-a.x)<=l?(h=g.x,d=1,this._log("左边与右边对齐")):Math.abs(m.x-a.x)<=l?(h=m.x,d=1,this._log("右边与右边对齐")):Math.abs(m.x-r.x)<=l&&(h=m.x,d=0,this._log("右边与左边对齐")),null!==h&&(c=.5===d?v.z:o.z>v.z?g.z:m.z,t.object3d.position.x=.5===d?h:1===d?h-.5*s.x:h+.5*s.x)),null===p&&(Math.abs(v.z-o.z)<=l?(p=v.z,f=.5,this._log("横向居中对齐")):Math.abs(m.z-a.z)<=l?(p=m.z,f=0,this._log("前边对齐")):Math.abs(m.z-r.z)<=l?(p=m.z,f=1,this._log("前边与后边对齐")):Math.abs(g.z-r.z)<=l?(p=g.z,f=1,this._log("后边与后边对齐")):Math.abs(g.z-a.z)<=l&&(p=g.z,f=0,this._log("后边与前边对齐")),null!==p&&(u=.5===f?v.x:o.x>v.x?g.x:m.x,t.object3d.position.z=.5===f?p:1===f?p+.5*s.z:p-.5*s.z)),null==h&&null==p||this._adsorb(),null!=h&&null!=p});const v=new e.Vector3,g=new e.Vector3;.5===d?v.copy(o):v.set(h,o.y,c>o.z?r.z:a.z),.5===f?g.copy(o):g.set(u>o.x?r.x:a.x,o.y,p);let{verticalLeft:m,verticalDepth:w,verticalStart:y,horizontalDepth:_,horizontalLeft:b,horizontalStart:x}=this._fullMatchCompute({verticalLeft:h,verticalDepth:c,verticalStart:v,horizontalDepth:p,horizontalLeft:u,horizontalStart:g,verticalFix:d,horizontalFix:f,nodeCenter:o});this._drawLine({verticalLeft:m,verticalDepth:w,verticalStart:y,horizontalDepth:_,horizontalLeft:b,horizontalStart:x})}onDrag(t){const{ObjectManager:e}=n.a.easy3DAPI;if(this.enable){let i=e.Instance.getBaseObj(t.id);this._findAlign(i)}}onDragComplete(){this.enable&&setTimeout(()=>{this.vertical&&(this.vertical.visible=!1),this.horizontal&&(this.horizontal.visible=!1)},100)}enableSnapline(t){this.enable=t}removeSelf(){this.modelsArray.forEach(t=>{t.off(g.i.TransformChange,this._modelEventCb)}),this.viewer.off(g.l.Add,this._viewerEventCb),this.enableSnapline(!1),this.viewer=null,this.box=null,this.tolerance=null,this.sensitivity=null,this.fullMatch=null,this.lineColor=null,this.logEnable=null,this.modelsArray=null,this.vertical=null,this.horizontal=null,this._modelEventCb=null,this._viewerEventCb=null}static create(t,e){return P.instance||(P.instance=new P(t,e)),P.instance}}P.pluginName="SnaplineCapture",P.instance=null;var C=P;function A(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=h()(t);if(e){var o=h()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return a()(this,i)}}const S=t=>{const{THREE:e,BaseTool:i,Polygon:n,Line:o,Sprite:r}=t;return{PointsDraw:class{constructor(t,n){this._viewer=t,this.points=[],this.once=!1,this._dataPoint={data:{position:[0,0,0],scale:[.3,.3,.3],isAdd:!0},material:{map:this.drawCoordinates(100)}},null==n.options?this._dataPoint.material=Object.assign({},this._dataPoint.material,{}):n.options.material instanceof e.SpriteMaterial?this._dataPoint.material=n.options.material:this._dataPoint.material=Object.assign({},this._dataPoint.material,n.options.material),null!=n.options&&(this._dataPoint.data=Object.assign({},this._dataPoint.data,n.options.data)),this._dbclickCallback=t=>{clearTimeout(this._delayed),0==n.once&&1==n.afterRemoveDraw?this.draw():0!=n.once||0!=n.afterRemoveDraw&&null!=n.afterRemoveDraw?this.remove(!1):this.draw(),i.Validator.isFunction(n.drawend)&&n.drawend(this.points[this.points.length-1])},this.creatRemoveEvent(),this._drawingCallback=e=>{clearTimeout(this._delayed),this._delayed=setTimeout(()=>{e.intersect&&(this._dataPoint.data.position=[e.intersect.point.x,e.intersect.point.y,e.intersect.point.z],this.points.push(new r(t,this._dataPoint.data,this._dataPoint.material)),i.Validator.isFunction(n.drawing)&&n.drawing(this.points[this.points.length-1])),this.once&&(this.remove(!1),i.Validator.isFunction(n.drawend)&&n.drawend(this.points[this.points.length-1]))},200)}}draw(){this._clickEvent&&(this._viewer.off(g.l.Click,this._drawingCallback),this._clickEvent=null),this._clickEvent=this._viewer.on(g.l.Click,this._drawingCallback,{target:this._viewer})}drawCoordinates(t){var e=document.createElement("canvas");e.width=2*t+60,e.height=2*t+60;var i=e.getContext("2d");return i.fillStyle="#FFFFFF",i.beginPath(),i.arc(t+30,t+30,t+30,0,2*Math.PI,!0),i.fill(),i.fillStyle="#0066FF",i.beginPath(),i.arc(t+30,t+30,t-20,0,2*Math.PI,!0),i.fill(),e}remove(t){if(this._viewer.off(g.l.Click,this._drawingCallback),this._viewer.off(g.l.Dblclick,this._dbclickCallback),t){for(let t in this.points)this.points[t].removeSelf();this.points=[]}}creatRemoveEvent(){this._viewer.on(g.l.Dblclick,this._dbclickCallback,{target:this._viewer})}},LineDraw:class{constructor(e,n){this._viewer=e,this.lines=[],this._over=!0,this.heightHelp=!1,this._nowPoint=[],this._first=!0,this.dataLine={data:{points:[],isAdd:!0},material:{color:"#3366FF",width:2,dashed:!0,gapSize:.3,dashSize:.5}};let r=function(t){var e=t.ShaderLib,i=t.ShaderMaterial,n=t.UniformsLib,o=t.UniformsUtils,r=t.Vector2;return n.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new r(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},e.line={uniforms:o.merge([n.common,n.fog,n.line]),vertexShader:"\n\t\t\t#include <common>\n\t\t\t#include <color_pars_vertex>\n\t\t\t#include <fog_pars_vertex>\n\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t#include <clipping_planes_pars_vertex>\n\n\t\t\tuniform float linewidth;\n\t\t\tuniform vec2 resolution;\n\n\t\t\tattribute vec3 instanceStart;\n\t\t\tattribute vec3 instanceEnd;\n\n\t\t\tattribute vec3 instanceColorStart;\n\t\t\tattribute vec3 instanceColorEnd;\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\tvarying vec4 worldPos;\n\t\t\t\tvarying vec3 worldStart;\n\t\t\t\tvarying vec3 worldEnd;\n\n\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t#endif\n\n\t\t\t#else\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tuniform float dashScale;\n\t\t\t\tattribute float instanceDistanceStart;\n\t\t\t\tattribute float instanceDistanceEnd;\n\t\t\t\tvarying float vLineDistance;\n\n\t\t\t#endif\n\n\t\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t\t// conservative estimate of the near plane\n\t\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\t#ifdef USE_COLOR\n\n\t\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t\t#endif\n\n\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\t\t\t\t\tvUv = uv;\n\n\t\t\t\t#endif\n\n\t\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\t\t// camera space\n\t\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\tworldStart = start.xyz;\n\t\t\t\t\tworldEnd = end.xyz;\n\n\t\t\t\t#else\n\n\t\t\t\t\tvUv = uv;\n\n\t\t\t\t#endif\n\n\t\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\t\tif ( perspective ) {\n\n\t\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// clip space\n\t\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t\t// ndc space\n\t\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\n\t\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n\t\t\t\t// direction\n\t\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\n\n\t\t\t\t// account for clip-space aspect ratio\n\t\t\t\tdir.x *= aspect;\n\t\t\t\tdir = normalize( dir );\n\n\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t// get the offset direction as perpendicular to the view vector\n\t\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\n\t\t\t\t\tvec3 offset;\n\t\t\t\t\tif ( position.y < 0.5 ) {\n\n\t\t\t\t\t\toffset = normalize( cross( start.xyz, worldDir ) );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\toffset = normalize( cross( end.xyz, worldDir ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// sign flip\n\t\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t\tfloat forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\n\n\t\t\t\t\t// don't extend the line if we're rendering dashes because we\n\t\t\t\t\t// won't be rendering the endcaps\n\t\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t\t// extend the line bounds to encompass  endcaps\n\t\t\t\t\t\tstart.xyz += - worldDir * linewidth * 0.5;\n\t\t\t\t\t\tend.xyz += worldDir * linewidth * 0.5;\n\n\t\t\t\t\t\t// shift the position of the quad so it hugs the forward edge of the line\n\t\t\t\t\t\toffset.xy -= dir * forwardOffset;\n\t\t\t\t\t\toffset.z += 0.5;\n\n\t\t\t\t\t#endif\n\n\t\t\t\t\t// endcaps\n\t\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\n\n\t\t\t\t\t\toffset.xy += dir * 2.0 * forwardOffset;\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// adjust for linewidth\n\t\t\t\t\toffset *= linewidth * 0.5;\n\n\t\t\t\t\t// set the world position\n\t\t\t\t\tworldPos = ( position.y < 0.5 ) ? start : end;\n\t\t\t\t\tworldPos.xyz += offset;\n\n\t\t\t\t\t// project the worldpos\n\t\t\t\t\tvec4 clip = projectionMatrix * worldPos;\n\n\t\t\t\t\t// shift the depth of the projected points so the line\n\t\t\t\t\t// segments overlap neatly\n\t\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n\t\t\t\t\tclip.z = clipPose.z * clip.w;\n\n\t\t\t\t#else\n\n\t\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\t\tdir.x /= aspect;\n\t\t\t\t\toffset.x /= aspect;\n\n\t\t\t\t\t// sign flip\n\t\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t\t// endcaps\n\t\t\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\t\t\toffset += - dir;\n\n\t\t\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\t\t\toffset += dir;\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// adjust for linewidth\n\t\t\t\t\toffset *= linewidth;\n\n\t\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\t\toffset /= resolution.y;\n\n\t\t\t\t\t// select end\n\t\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t\t\t// back to clip space\n\t\t\t\t\toffset *= clip.w;\n\n\t\t\t\t\tclip.xy += offset;\n\n\t\t\t\t#endif\n\n\t\t\t\tgl_Position = clip;\n\n\t\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t\t#include <logdepthbuf_vertex>\n\t\t\t\t#include <clipping_planes_vertex>\n\t\t\t\t#include <fog_vertex>\n\n\t\t\t}\n\t\t\t",fragmentShader:"\n\t\t\tuniform vec3 diffuse;\n\t\t\tuniform float opacity;\n\t\t\tuniform float linewidth;\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tuniform float dashOffset;\n\t\t\t\tuniform float dashSize;\n\t\t\t\tuniform float gapSize;\n\n\t\t\t#endif\n\n\t\t\tvarying float vLineDistance;\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\tvarying vec4 worldPos;\n\t\t\t\tvarying vec3 worldStart;\n\t\t\t\tvarying vec3 worldEnd;\n\n\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\t#endif\n\n\t\t\t#else\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t#endif\n\n\t\t\t#include <common>\n\t\t\t#include <color_pars_fragment>\n\t\t\t#include <fog_pars_fragment>\n\t\t\t#include <logdepthbuf_pars_fragment>\n\t\t\t#include <clipping_planes_pars_fragment>\n\n\t\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\n\n\t\t\t\tfloat mua;\n\t\t\t\tfloat mub;\n\n\t\t\t\tvec3 p13 = p1 - p3;\n\t\t\t\tvec3 p43 = p4 - p3;\n\n\t\t\t\tvec3 p21 = p2 - p1;\n\n\t\t\t\tfloat d1343 = dot( p13, p43 );\n\t\t\t\tfloat d4321 = dot( p43, p21 );\n\t\t\t\tfloat d1321 = dot( p13, p21 );\n\t\t\t\tfloat d4343 = dot( p43, p43 );\n\t\t\t\tfloat d2121 = dot( p21, p21 );\n\n\t\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\n\n\t\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\n\n\t\t\t\tmua = numer / denom;\n\t\t\t\tmua = clamp( mua, 0.0, 1.0 );\n\t\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\n\t\t\t\tmub = clamp( mub, 0.0, 1.0 );\n\n\t\t\t\treturn vec2( mua, mub );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t\t#ifdef USE_DASH\n\n\t\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t\t#endif\n\n\t\t\t\tfloat alpha = opacity;\n\n\t\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t\t// Find the closest points on the view ray and the line segment\n\t\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\n\t\t\t\t\tvec3 lineDir = worldEnd - worldStart;\n\t\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\n\n\t\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\n\t\t\t\t\tvec3 p2 = rayEnd * params.y;\n\t\t\t\t\tvec3 delta = p1 - p2;\n\t\t\t\t\tfloat len = length( delta );\n\t\t\t\t\tfloat norm = len / linewidth;\n\n\t\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\t\tfloat dnorm = fwidth( norm );\n\t\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\n\n\t\t\t\t\t\t#else\n\n\t\t\t\t\t\t\tif ( norm > 0.5 ) {\n\n\t\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#else\n\n\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\t\t\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#endif\n\n\t\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\n\t\t\t\t#include <logdepthbuf_fragment>\n\t\t\t\t#include <color_fragment>\n\n\t\t\t\tgl_FragColor = vec4( diffuseColor.rgb, alpha );\n\n\t\t\t\t#include <tonemapping_fragment>\n\t\t\t\t#include <colorspace_fragment>\n\t\t\t\t#include <fog_fragment>\n\t\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t\t}\n\t\t\t"},function(t){s()(n,t);var i=A(n);function n(t){var s;return p()(this,n),(s=i.call(this,{type:"LineMaterial",uniforms:o.clone(e.line.uniforms),vertexShader:e.line.vertexShader,fragmentShader:e.line.fragmentShader,clipping:!0})).isLineMaterial=!0,s.setValues(t),s}return d()(n,[{key:"color",get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},{key:"worldUnits",get:function(){return"WORLD_UNITS"in this.defines},set:function(t){!0===t?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},{key:"linewidth",get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth&&(this.uniforms.linewidth.value=t)}},{key:"dashed",get:function(){return"USE_DASH"in this.defines},set:function(t){!0===t!==this.dashed&&(this.needsUpdate=!0),!0===t?this.defines.USE_DASH="":delete this.defines.USE_DASH}},{key:"dashScale",get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},{key:"dashSize",get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},{key:"dashOffset",get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},{key:"gapSize",get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},{key:"opacity",get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms&&(this.uniforms.opacity.value=t)}},{key:"resolution",get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},{key:"alphaToCoverage",get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(t){this.defines&&(!0===t!==this.alphaToCoverage&&(this.needsUpdate=!0),!0===t?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1))}}]),n}(i)}(t.THREE);null==n.options?this.dataLine.material=Object.assign({},this.dataLine.material,{}):n.options.material instanceof r?this.dataLine.material=n.options.material:this.dataLine.material=Object.assign({},this.dataLine.material,n.options.material),null!=n.options&&(this.dataLine.data=Object.assign({},this.dataLine.data,n.options.data)),this._drawingCallback=t=>{clearTimeout(this._delayed),t.intersect&&(this._first=!1,this._nowPoint=[t.intersect.point.x,t.intersect.point.y,t.intersect.point.z]),this._delayed=setTimeout(()=>{if(this._first=!0,this._over=!1,t.intersect){if(0==this.dataLine.data.points.length)for(let e=0;e<2;e++)this.dataLine.data.points.push([t.intersect.point.x,t.intersect.point.y,t.intersect.point.z]);else this.dataLine.data.points.push([t.intersect.point.x,t.intersect.point.y,t.intersect.point.z]),0!==this._nowPoint.length&&(this.dataLine.data.points[this.dataLine.data.points.length-2]=this._nowPoint);2==this.dataLine.data.points.length?this.lines.push(new o(e,this.dataLine.data,this.dataLine.material)):this.dataLine.data.points.length>2&&(this.lines[this.lines.length-1].updatePoints(this.dataLine.data.points),this.dataLine.data.points.length>1&&i.Validator.isFunction(n.drawing)&&n.drawing(this.lines[this.lines.length-1]))}},200)},this._dbclickCallback=t=>{this._first=!1,this._over=!0,clearTimeout(this._delayed),this.dataLine.data.points.length>0&&(this.dataLine.data.points.pop(),this.lines.length>0&&this.lines[this.lines.length-1].updatePoints(this.dataLine.data.points)),1==this.dataLine.data.points.length&&1==this.lines.length&&(this.lines[0].removeSelf(),this.lines=[],this.dataLine.data.points=[]),0==n.once&&1==n.afterRemoveDraw?(this.dataLine.data.points=[],this.draw()):0!=n.once||0!=n.afterRemoveDraw&&null!=n.afterRemoveDraw?this.remove(!1):(this.dataLine.data.points=[],this.draw()),i.Validator.isFunction(n.drawend)&&n.drawend(this.lines[this.lines.length-1])},this._moveingCallback=t=>{t.intersect&&this.dataLine.data.points.length>0&&this._first&&(this.dataLine.data.points.pop(),this.dataLine.data.points.push([t.intersect.point.x,t.intersect.point.y,t.intersect.point.z]),this.lines[this.lines.length-1].updatePoints(this.dataLine.data.points))},this.moveChange(),this.creatRemoveEvent()}draw(){this._clickEvent&&(this._viewer.off(g.l.Click,this._drawingCallback),this._clickEvent=null),this._viewer.on(g.l.Click,this._drawingCallback,{target:this._viewer})}moveChange(){this._moveEvent&&(this._viewer.off(g.l.Mousemove,this._moveingCallback),this._moveEvent=null),this._viewer.on(g.l.Mousemove,this._moveingCallback,{target:this._viewer})}remove(t){if(t){for(let t in this.lines)this.lines[t].removeSelf();this.lines=[],this.dataLine.data.points=[]}this._over||this.heightHelp||(this.lines[this.lines.length-1].removeSelf(),this.lines.pop()),this._viewer.off(g.l.Click,this._drawingCallback),this._viewer.off(g.l.Dblclick,this._dbclickCallback),this._viewer.off(g.l.Mousemove,this._moveingCallback),this._over=!0}creatRemoveEvent(){this._viewer.on(g.l.Dblclick,this._dbclickCallback,{target:this._viewer})}},AreaDraw:class{constructor(t,o){this._viewer=t,this.areas=[],this._over=!0,this.dataArea={data:{points:[],isAdd:!0},material:{color:"yellow",opacity:.5,side:"double"}},null==o.options?this.dataArea.material=Object.assign({},this.dataArea.material,{}):o.options.material instanceof e.MeshStandardMaterial?this.dataArea.material=o.options.material:this.dataArea.material=Object.assign({},this.dataArea.material,o.options.material),null!=o.options&&(this.dataArea.data=Object.assign({},this.dataArea.data,o.options.data)),this._drawingCallback=e=>{clearTimeout(this._delayed),this._delayed=setTimeout(()=>{this._over=!1,e.intersect&&(this.dataArea.data.points.push([e.intersect.point.x,e.intersect.point.y,e.intersect.point.z]),3==this.dataArea.data.points.length?this.areas.push(new n(t,this.dataArea.data,this.dataArea.material)):this.dataArea.data.points.length>3&&this.areas[this.areas.length-1].updatePoints(this.dataArea.data.points),this.dataArea.data.points.length>2&&i.Validator.isFunction(o.drawing)&&o.drawing(this.areas[this.areas.length-1]))},200)},this._dbclickCallback=t=>{this._over=!0,this.dataArea.data.points=[],clearTimeout(this._delayed),0==o.once&&1==o.afterRemoveDraw?this.draw():0!=o.once||0!=o.afterRemoveDraw&&null!=o.afterRemoveDraw?this.remove(!1):this.draw(),i.Validator.isFunction(o.drawend)&&o.drawend(this.areas[this.areas.length-1])},this.creatRemoveEvent()}draw(){this._clickEvent&&(this._viewer.off(g.l.Click,this._drawingCallback),this._clickEvent=null),this._viewer.on(g.l.Click,this._drawingCallback,{target:this._viewer})}remove(t){if(this._viewer.off(g.l.Click,this._drawingCallback),this._viewer.off(g.l.Dblclick,this._dbclickCallback),!this._over&&this.areas.length>0&&(this.areas[this.areas.length-1].removeSelf(),this.areas.pop()),t){for(let t in this.areas)this.areas[t].removeSelf();this.areas=[]}this._over=!0}creatRemoveEvent(){this._viewer.on(g.l.Dblclick,this._dbclickCallback,{target:this._viewer})}}}},k=t=>{const{THREE:e,BaseTool:i,Viewer:n,Sprite:o,Popup:s,Line:r}=t,a=S(t),l=class{constructor(t,e){this._viewer=t,this._drawPopup=!0,this._first=!1,this._over=!0,this._nowposition=[],this._popupsPositions=[],this.distance=[],this.allcount=!0,this.drawPoint=new a.PointsDraw(t,{type:g.c.Point,options:e.spriteOptions,once:e.once,afterRemoveDraw:e.afterRemoveDraw}),this.drawPoint.draw(),this.drawLine=new a.LineDraw(t,{type:g.c.Line,options:e.lineOptions,once:e.once,afterRemoveDraw:e.afterRemoveDraw}),this.drawLine.draw(),this._popupOptions={type:g.g.Popup2D,wordColor:"black",bgColor:"rgba(250, 250, 250, 0.8)",scale:[.01,.01,.01],lookToCamera:!0},e.popupOptions&&(this._popupOptions=Object.assign({},this._popupOptions,e.popupOptions)),this.popups=new s(t),this._drawingCallback=t=>{t.intersect&&(this._over=!1,this._drawPopup=!1,this._nowposition=[t.intersect.point.x,t.intersect.point.y+1.5,t.intersect.point.z]),clearTimeout(this._delayed),this._delayed=setTimeout(()=>{t.intersect&&(2==this.drawLine.lines[this.drawLine.lines.length-1].options.points.length?(this.compute(),this.popups.createPopup(this.popupData("起点")),this.popups.createPopup(this.popupData())):(this._popupsPositions.pop(),this._popupsPositions.push(this._nowposition),this.getnewdistance(),this.popups.get()[this.popups.get().length-1].config(this.popupData()),this.compute(),this.popups.createPopup(this.popupData()),i.Validator.isFunction(e.drawing)&&e.drawing(this.distance[this.distance.length-2])),this._drawPopup=!0,this._first=!0)},200)},this._moveingCallback=t=>{t.intersect&&this.popups.get().length>1&&this._drawPopup&&(this.compute(!0),this.popups.get()[this.popups.get().length-1].config(this.popupData("isPrompt")))},this._dbclickCallback=t=>{if(this._over=!0,clearTimeout(this._delayed),this._first)if(1==this.drawPoint.points.length)this.drawPoint.points[this.drawPoint.points.length-1].removeSelf(),this.drawPoint.points=[],this.popups.remove();else if(this.drawPoint.points.length>1){let t=this.drawLine.lines[this.drawLine.lines.length-1].options.points.length;if((t>1&&this.allcount||t>2&&!this.allcount)&&this.popups.get()[this.popups.get().length-1].removeSelf(),this.distance.pop(),t<3&&!this.allcount||this.allcount&&1==t){if(this.allcount)this.popups.remove(this.popups.get()[this.popups.get().length-1].id),this.drawPoint.points[this.drawPoint.points.length-1].removeSelf(),this.drawPoint.points.pop();else for(let e=0;e<t;e++)this.drawPoint.points[this.drawPoint.points.length-1].removeSelf(),this.drawPoint.points.pop(),this.popups.remove(this.popups.get()[this.popups.get().length-1].id);1!==this.drawLine.lines.length?this.popups.remove(this.popups.get()[this.popups.get().length-1].id):this.popups.remove(),this.drawLine.lines[this.drawLine.lines.length-1].removeSelf(),this.drawLine.lines.pop()}else if(this.allcount){let t=0;for(let e=0;e<this.drawLine.lines[this.drawLine.lines.length-1].options.points.length-1;e++)t+=this.distance[this.distance.length-1-e];t>999?(t=Math.floor(t/10)/100,this.popups.get()[this.popups.get().length-2].config(this.popupData(t+"km","总距离："))):(t=Math.floor(100*t)/100,this.popups.get()[this.popups.get().length-2].config(this.popupData(t+"m","总距离："))),this.popups.get()[this.popups.get().length-2].object3d.element.getElementsByTagName("img")[0].style.display="block"}}0==e.once&&1==e.afterRemoveDraw?(this._drawPopup=!1,this._first=!1,this.draw()):0!=e.once||0!=e.afterRemoveDraw&&null!=e.afterRemoveDraw?this.remove(!1):(this._drawPopup=!1,this._first=!1,this.draw()),i.Validator.isFunction(e.drawend)&&e.drawend()},this.moveChange(),this.draw(),this.creatRemoveEvent()}remove(t){if(this.drawPoint.remove(t),this.drawLine.remove(t),this._viewer.off(g.l.Click,this._drawingCallback),this._viewer.off(g.l.Dblclick,this._dbclickCallback),this._viewer.off(g.l.Mousemove,this._moveingCallback),!this._over){let t=this.drawLine.dataLine.data.points.length;for(let e=0;e<t-1;e++)this.drawPoint.points[this.drawPoint.points.length-1].removeSelf(),this.drawPoint.points.pop(),this.popups.remove(this.popups.get()[this.popups.get().length-1].id);i.Validator.isArray(this.popups.get())?this.popups.remove(this.popups.get()[this.popups.get().length-1].id):this.popups.remove()}t&&(this.distance=[],this._popupsPositions=[],this.popups.remove()),this._over=!0}moveChange(){this._moveEvent&&(this._viewer.off(g.l.Mousemove,this._moveingCallback),this._moveEvent=null),this._viewer.on(g.l.Mousemove,this._moveingCallback,{target:this._viewer})}draw(){this._clickEvent&&(this._viewer.off(g.l.Click,this._drawingCallback),this._clickEvent=null),this._clickEvent=this._viewer.on(g.l.Click,this._drawingCallback,{target:this._viewer})}creatRemoveEvent(){this._viewer.on(g.l.Dblclick,this._dbclickCallback,{target:this._viewer})}compute(t){let i=this.drawLine.lines.length,n=this.drawLine.lines[i-1].options.points,o=new e.Vector3(n[n.length-2][0],n[n.length-2][1],n[n.length-2][2]),s=new e.Vector3(n[n.length-1][0],n[n.length-1][1],n[n.length-1][2]),r=o.distanceTo(s),a=[n[n.length-1][0],n[n.length-1][1]+1.5,n[n.length-1][2]];t?(this._popupsPositions[this._popupsPositions.length-1]=a,this.distance[this.distance.length-1]=Math.floor(100*r)/100):(this._popupsPositions.push(a),this.distance.push(Math.floor(100*r)/100))}getnewdistance(){let t=this.drawPoint.points[this.drawPoint.points.length-1].options.position,i=this.drawPoint.points[this.drawPoint.points.length-2].options.position,n=new e.Vector3(i[0],i[1],i[2]),o=new e.Vector3(t[0],t[1],t[2]),s=n.distanceTo(o);this.distance[this.distance.length-1]=Math.floor(100*s)/100}popupData(t,e){let i={type:this._popupOptions.type,element:null,position:this._popupsPositions[this._popupsPositions.length-1],scale:this._popupOptions.scale,lookToCamera:this._popupOptions.lookToCamera,properties:{}};if(t)if("isPrompt"===t){let t=null;if(this.distance[this.distance.length-1]>999){t=Math.floor(this.distance[this.distance.length-1]/10)/100+"km"}else{t=Math.floor(100*this.distance[this.distance.length-1])/100+"m"}i.element=this.getPopupContent({name:t,wordColor:this._popupOptions.wordColor,bgColor:this._popupOptions.bgColor,display:"none",type:e||"距离  "});const n=document.createElement("div");n.innerHTML='<div style="color:#555555;font-size:16px;">双击结束测量</div>',i.element.childNodes[0].style.width="14vh",i.element.childNodes[0].childNodes[1].appendChild(n.childNodes[0])}else i.element=this.getPopupContent({name:t,wordColor:this._popupOptions.wordColor,bgColor:this._popupOptions.bgColor,display:"none",type:e||""}),i.position=this.drawPoint.points[this.drawPoint.points.length-1].options.position,i.position[1]+=1.5;else{let t={name:this.distance[this.distance.length-1]+"m",wordColor:this._popupOptions.wordColor,bgColor:this._popupOptions.bgColor,display:"none",type:""};if(this.distance[this.distance.length-1]>999){let e=Math.floor(this.distance[this.distance.length-1]/10)/100;t.name=e+"km"}else{let e=Math.floor(100*this.distance[this.distance.length-1])/100;t.name=e+"m"}i.element=this.getPopupContent(t)}return i}getPopupContent(t){let e=h.getStyle(t);if(1!=this.drawPoint.points.length){let t=this.drawLine.lines.length-1,i=this.drawPoint.points.length-1,n=this.drawLine.lines[t].options.points.length;e.getElementsByTagName("img")[0].addEventListener("click",e=>{e.stopPropagation(),this.drawLine.lines[t].removeSelf();const o=this.popups.get();1===o.length&&o[0].removeSelf();for(let e=0;e<n;e++)this.drawPoint.points[i-e].removeSelf(),o.length>1&&o[i-e+t].removeSelf()})}return e}},h=class{static getStyle(t){var e=document.createElement("div");return e.innerHTML='<div style=" width: 30vh;\n            pointer-events: none;\n\n            display: flex;\n            align-items: center;\n            justify-content: center;">\n            <div id=\'popup\' style=" box-sizing: border-box;\n            padding: 8px 10px;\n            display: flex;\n            flex-wrap:wrap;\n            align-items: center;\n            justify-content: space-between;\n            font-size: 18px;\n            line-height: 20px;\n            background: '+t.bgColor+';\n            border-radius: 10%;">\n            <div style="display: flex;width:100%;">\n                <span style="color:#777777">'+t.type+'</span>\n                <span style="color:'+t.wordColor+'">'+t.name+'</span>\n                <img name="Measurepopups"\n                    style=" width: 20px;\n                    height: 20px;\n                    pointer-events: auto;\n                    cursor: pointer;\n                    margin-left: 5px;\n                    display: '+t.display+';\n                    "\n                    src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAABHNCSVQICAgIfAhkiAAAALBJREFUSEtjZKADYKSDHQyjlpAUygMbXEZGRg/+/fsXcAEI8DnbAAiYmJg2ANUaAJV+wKYWp0+QNOO0iBg1IEvxBhc+Q4i1gKAlIAXYDCPFAqIsQbcIxIfGAcH4gsUP0akL5nqQRmISBHICGDyWIMcBTYKL5hFP8yRMTDIlRg3eJExqsXLu3DkFXMUPvmJFAFdZhG4Y0EcKQLUPSLaEpLKcgGKi8wkllo5aQlLo0SW4AJ8BrBqub0GgAAAAAElFTkSuQmCC"\n                    alt=""\n                />\n            </div>\n            </div>\n        </div>',e.style.pointerEvents="none",e}static drawCoordinates(t){var e=document.createElement("canvas");e.width=2*t+60,e.height=2*t+60;var i=e.getContext("2d");return i.fillStyle="#0066FF",i.beginPath(),i.arc(t+30,t+30,t+30,0,2*Math.PI,!0),i.fill(),i.fillStyle="#FFFFFF",i.beginPath(),i.arc(t+30,t+30,t-20,0,2*Math.PI,!0),i.fill(),e}};return{MeasureLength:l,MeasureArea:class{constructor(t,e){this._viewer=t,this._popupsPositions=[],this.acreage=[],this._over=!0,this._popupOptions={type:g.g.Popup2D,wordColor:"black",bgColor:"rgba(250, 250, 250, 0.8)",scale:[.01,.01,.01],lookToCamera:!0},e.popupOptions&&(this._popupOptions=Object.assign({},this._popupOptions,e.popupOptions)),this.drawArea=new a.AreaDraw(t,{type:g.c.Area,options:e.areaOptions,once:e.once,afterRemoveDraw:e.afterRemoveDraw}),this.drawArea.draw(),this.popups=new s(t),this._measureLength=new l(t,{type:e.type,once:e.once,afterRemoveDraw:e.afterRemoveDraw,lineOptions:e.lineOptions,spriteOptions:e.spriteOptions,popupOptions:e.popupOptions}),this._measureLength.allcount=!1,this._drawingCallback=t=>{clearTimeout(this._delayed),this._delayed=setTimeout(()=>{if(this._over=!1,this.drawArea.areas.length>0)if(this.compute(),i.Validator.isFunction(e.drawing)&&this.drawArea.dataArea.data.points.length>2&&e.drawing(this.acreage[this.acreage.length-1]),3==this.drawArea.dataArea.data.points.length)this.popups.createPopup(this.popupData());else if(this.drawArea.dataArea.data.points.length>3){const t=this.popups.get();t.length>1?this.popups.get()[this.drawArea.areas.length-1].config(this.popupData()):1===t.length&&t[0].config(this.popupData())}},200)},this.draw(),this._dbclickCallback=t=>{this._over=!0,clearTimeout(this._delayed);const n=this.popups.get();void 0!==n[n.length-1]&&(n[n.length-1].object3d.element.getElementsByTagName("img")[0].style.display="block"),0==e.once&&1==e.afterRemoveDraw?this.draw():0!=e.once||0!=e.afterRemoveDraw&&null!=e.afterRemoveDraw?this.remove(!1):this.draw(),i.Validator.isFunction(e.drawend)&&e.drawend()},this.creatRemoveEvent()}remove(t){!this._over&&this.drawArea.areas.length>0&&(i.Validator.isArray(this.popups.get())?this.popups.remove(this.popups.get()[this.popups.get().length-1].id):this.popups.remove()),this.drawArea.remove(t),this._measureLength.remove(t),this._viewer.off(g.l.Click,this._drawingCallback),this._viewer.off(g.l.Dblclick,this._dbclickCallback),t&&(this.acreage=[],this._popupsPositions=[],this.popups.remove()),this._over=!0}draw(){this._clickEvent&&(this._viewer.off(g.l.Click,this._drawingCallback),this._clickEvent=null),this._clickEvent=this._viewer.on(g.l.Click,this._drawingCallback,{target:this._viewer})}creatRemoveEvent(){this._viewer.on(g.l.Dblclick,this._dbclickCallback,{target:this._viewer})}compute(){let t=0,e=0,i=0,n=0,o=0,s=this.drawArea.areas[this.drawArea.areas.length-1].options;for(let i=0;i<s.points.length-1;i++)"scsight"!==this._viewer.pluginType?(t+=s.points[i][0]*s.points[i+1][2],e+=s.points[i][2]*s.points[i+1][0]):(t+=s.points[i][0]*s.points[i+1][1],e+=s.points[i][1]*s.points[i+1][0]);"scsight"!==this._viewer.pluginType?(t+=s.points[s.points.length-1][0]*s.points[0][2],e+=s.points[s.points.length-1][2]*s.points[0][0]):(t+=s.points[s.points.length-1][0]*s.points[0][1],e+=s.points[s.points.length-1][1]*s.points[0][0]);for(let t=0;t<s.points.length;t++)i+=s.points[t][0],n+=s.points[t][1],o+=s.points[t][2];this.drawArea.areas.length==this.acreage.length?(this.acreage[this.acreage.length-1]=Math.floor(50*Math.abs(t-e))/100,this._popupsPositions[this._popupsPositions.length-1]=[i/s.points.length,n/s.points.length,o/s.points.length]):(this.acreage.push(Math.floor(50*Math.abs(t-e))/100),this._popupsPositions.push([i/s.points.length,n/s.points.length,o/s.points.length]))}getPopupContent(t){let e=h.getStyle(t),n=this.drawArea.areas.length-1,o=this._measureLength.drawLine.lines.length-1,s=this._measureLength.drawPoint.points.length-1,r=this._measureLength.drawLine.lines[n].options.points.length;return e.getElementsByTagName("img")[0].addEventListener("click",t=>{t.stopPropagation();const e=this.popups.get();e.length>1?e[n].removeSelf():1===e.length&&e[0].removeSelf(),this.drawArea.areas[n].removeSelf();const a=this._measureLength.popups.get();if(this._measureLength.drawLine.lines[o].removeSelf(),1===a.length&&a[0].removeSelf(),0==o)for(let t=0;t<r-1;t++)this._measureLength.drawPoint.points[s-t].removeSelf(),a.length>1&&this._measureLength.popups.get()[s-t+o].removeSelf();else for(let t=0;t<r;t++)this._measureLength.drawPoint.points[s-t].removeSelf(),r-1!==t&&i.Validator.isArray(this._measureLength.popups.get())&&this._measureLength.popups.get()[s-t+o].removeSelf()}),e}popupData(){let t={type:this._popupOptions.type,element:null,position:this._popupsPositions[this._popupsPositions.length-1],scale:this._popupOptions.scale,lookToCamera:this._popupOptions.lookToCamera,properties:{}},e={name:this.acreage[this.acreage.length-1]+"m²",wordColor:this._popupOptions.wordColor,bgColor:this._popupOptions.bgColor,display:"none",type:"面积："};if(this.acreage[this.acreage.length-1]>999){let t=Math.floor(this.acreage[this.acreage.length-1]/10)/100;e.name=t+"km²"}else{let t=Math.floor(100*this.acreage[this.acreage.length-1])/100;e.name=t+"m²"}return t.element=this.getPopupContent(e),t}},MeasureHeight:class{constructor(t,e){this._heightLine=[],this._heightPoint=[],this._popupsPositions=[],this.distance=[],this.drawLine=[],this._drawPopup=!0,this._over=!0,this._viewer=t,this._popupOptions={type:g.g.Popup2D,wordColor:"black",bgColor:"rgba(250, 250, 250, 0.8)",scale:[.01,.01,.01],lookToCamera:!0},e.popupOptions&&(this._popupOptions=Object.assign({},this._popupOptions,e.popupOptions)),this._measureOptions=e,this.drawPoint=new a.PointsDraw(t,{type:g.c.Point,options:e.spriteOptions,once:e.once,afterRemoveDraw:e.afterRemoveDraw}),this.drawPoint.draw(),this.drawLine.push(new a.LineDraw(t,{type:g.c.Line,options:e.lineOptions,once:!0,afterRemoveDraw:e.afterRemoveDraw})),this.drawLine[this.drawLine.length-1].draw(),this.popups=new s(t),this._drawingCallback=n=>{clearTimeout(this._delayed),n.intersect&&(this._drawPopup=!1),this._delayed=setTimeout(()=>{if(n.intersect){if(this._over=!1,this.drawPoint.points.length%2==0&&this.drawPoint.points.length>0){this.compute(),i.Validator.isFunction(e.drawing)&&e.drawing(this.distance[this.distance.length-1]);const n=this.popups.get();n.length>1?n[n.length-1].config(this.popupData()):1===n.length&&n[0].config(this.popupData()),this.drawLine[this.drawLine.length-1].heightHelp=!0,this.drawLine[this.drawLine.length-1].remove(!1),e.once?this.remove(!1):(this.drawLine.push(new a.LineDraw(t,{type:g.c.Line,options:e.lineOptions,once:!0,afterRemoveDraw:e.afterRemoveDraw})),this.drawLine[this.drawLine.length-1].draw())}else this.popups.createPopup(this.popupData()),this.distance.push(0),this._popupsPositions.push([n.intersect.point.x,n.intersect.point.y+1.5,n.intersect.point.z]);this._drawPopup=!0}},200)},this.draw(),this._dbclickCallback=t=>{this._over=!0,clearTimeout(this._delayed),this.drawPoint.points.length%2!=0&&(this.drawPoint.points[this.drawPoint.points.length-1].removeSelf(),this.drawPoint.points.pop(),this.distance.pop(),this._popupsPositions.pop(),i.Validator.isArray(this.popups.get())?this.popups.remove(this.popups.get()[this.popups.get().length-1].id):this.popups.remove()),0==e.once&&1==e.afterRemoveDraw?(this.drawPoint.remove(!1),this.remove(!1)):(0!=e.once||0!=e.afterRemoveDraw&&null!=e.afterRemoveDraw||this.drawPoint.remove(!1),this.remove(!1)),i.Validator.isFunction(e.drawend)&&e.drawend()},this.creatRemoveEvent(),this._moveingCallback=t=>{if(t.intersect&&Math.floor(this.drawPoint.points.length/2)+1==this.distance.length&&0!==this.popups.get().length&&this._drawPopup){let e=this.drawPoint.points.length-1;t.intersect.point.y>this.drawPoint.points[e].options.position[1]?this._popupsPositions[this._popupsPositions.length-1]=[t.intersect.point.x,t.intersect.point.y+1.5,t.intersect.point.z]:this._popupsPositions[this._popupsPositions.length-1]=[t.intersect.point.x,this.drawPoint.points[e].options.position[1]+1.5,t.intersect.point.z],this.distance[this.distance.length-1]=Math.floor(100*Math.abs(t.intersect.point.y-this.drawPoint.points[e].options.position[1]))/100;const i=this.popups.get();i.length>1?i[i.length-1].config(this.popupData("isPrompt")):1===i.length&&i[0].config(this.popupData("isPrompt"))}},this.moveChange()}remove(t){this.drawPoint.remove(t);for(let e in this.drawLine)this.drawLine[e].remove(t);if(this._viewer.off(g.l.Click,this._drawingCallback),this._viewer.off(g.l.Dblclick,this._dbclickCallback),this._viewer.off(g.l.Mousemove,this._moveingCallback),this._over||this._dbclickCallback("0"),t){this.popups.remove();for(let t in this._heightLine)this._heightLine[t].removeSelf();for(let t in this._heightPoint)this._heightPoint[t].removeSelf();this._heightPoint=[],this._heightLine=[],this.distance=[],this._popupsPositions=[],this.drawLine=[]}this._over=!0}moveChange(){this._moveEvent&&(this._viewer.off(g.l.Mousemove,this._moveingCallback),this._moveEvent=null),this._viewer.on(g.l.Mousemove,this._moveingCallback,{target:this._viewer})}draw(){this._clickEvent&&(this._viewer.off(g.l.Click,this._drawingCallback),this._clickEvent=null),this._clickEvent=this._viewer.on(g.l.Click,this._drawingCallback,{target:this._viewer})}creatRemoveEvent(){this._viewer.on(g.l.Dblclick,this._dbclickCallback,{target:this._viewer})}popupData(t){let e={type:this._popupOptions.type,element:null,position:this._popupsPositions[this._popupsPositions.length-1],scale:this._popupOptions.scale,lookToCamera:this._popupOptions.lookToCamera,properties:{}},i={name:this.distance[this.distance.length-1]+"m",wordColor:this._popupOptions.wordColor,bgColor:this._popupOptions.bgColor,display:"none",type:"高："};if(this.distance[this.distance.length-1]>999){let t=Math.floor(this.distance[this.distance.length-1]/10)/100;i.name=t+"km"}else if(this.distance[this.distance.length-1]){let t=Math.floor(100*this.distance[this.distance.length-1])/100;i.name=t+"m"}else i.name="0m";if(e.element=this.getPopupContent(i),t){const t=document.createElement("div");t.innerHTML='<div style="color:#555555;font-size:16px;">双击结束测量</div>',e.element.childNodes[0].style.width="14vh",e.element.childNodes[0].childNodes[1].appendChild(t.childNodes[0])}return e}compute(){let t,e,i=this.drawPoint.points.length-1;this.drawPoint.points[i-1].options.position[1]>this.drawPoint.points[i].options.position[1]?(t=[this.drawPoint.points[i-1].options.position[0],this.drawPoint.points[i].options.position[1],this.drawPoint.points[i-1].options.position[2]],this._popupsPositions[this._popupsPositions.length-1]=[this.drawPoint.points[i].options.position[0],this.drawPoint.points[i-1].options.position[1]+1.5,this.drawPoint.points[i].options.position[2]]):(t=[this.drawPoint.points[i].options.position[0],this.drawPoint.points[i-1].options.position[1],this.drawPoint.points[i].options.position[2]],this._popupsPositions[this._popupsPositions.length-1]=[this.drawPoint.points[i].options.position[0],this.drawPoint.points[i].options.position[1]+1.5,this.drawPoint.points[i].options.position[2]]),e=[this.drawPoint.points[i].options.position,t,this.drawPoint.points[i-1].options.position];let n=Math.abs(this.drawPoint.points[i-1].options.position[1]-this.drawPoint.points[i].options.position[1]);if(this.distance[this.distance.length-1]=Math.floor(100*n)/100,this._measureOptions.lineOptions){let t={points:e};t=Object.assign({},t,this._measureOptions.spriteOptions.data),this._heightLine.push(new r(this._viewer,t,this._measureOptions.lineOptions.material))}else this._heightLine.push(new r(this._viewer,{points:e},{}));if(this._measureOptions.spriteOptions){let e={position:t,scale:[.5,.5,.5]};e=Object.assign({},e,this._measureOptions.spriteOptions.data),this._heightPoint.push(new o(this._viewer,e,this._measureOptions.spriteOptions.material))}else this._heightPoint.push(new o(this._viewer,{position:t,scale:[.3,.3,.3]},{map:h.drawCoordinates(100)}))}getPopupContent(t){let e=h.getStyle(t),i=this.drawLine.length-1;return e.getElementsByTagName("img")[0].addEventListener("click",t=>{t.stopPropagation(),this.drawLine[i].lines[0].removeSelf(),this._heightLine[i].removeSelf(),this._heightPoint[i].removeSelf();const e=this.popups.get();1===e.length?e[0].removeSelf():e.length>1&&e[i].removeSelf();for(let t=0;t<2;t++)this.drawPoint.points[2*i+t].removeSelf()}),e}}}};class O extends n.a{constructor(t){super(t),this.engineVersion="3.0.1",this.version="0.01",this.measureBase=k(n.a.easy3DAPI),this.drawBase=S(n.a.easy3DAPI)}measure(t,e){this.measureObject&&(this.measureObject.remove(!1),this.measureObject=null),e.afterRemoveDraw&&this.removeAllMeasure(),t.container.ownerDocument.ondragstart=function(){return!1},e.type.toLocaleLowerCase()==g.h.Length?this.measureObject=new this.measureBase.MeasureLength(t,e):e.type.toLocaleLowerCase()==g.h.Area?this.measureObject=new this.measureBase.MeasureArea(t,e):e.type.toLocaleLowerCase()==g.h.Height&&(this.measureObject=new this.measureBase.MeasureHeight(t,e)),this.measureMade||(this.measureMade=[]),this.measureMade.push(this.measureObject)}removeAllMeasure(){if(this.measureMade){for(let t=0;t<this.measureMade.length;t++)this.measureMade[t].remove(!1),this.measureMade[t].remove(!0);this.measureMade=null}}removeThisMeasure(t){this.measureObject.remove(t)}draw(t,e){if(this.drawObject&&(this.drawObject.remove(!1),this.drawObject=null),e.afterRemoveDraw&&this.removeAllDraw(),e.type.toLocaleLowerCase()==g.c.Point){let i=e.once;e.once=!0,this.drawObject=new this.drawBase.PointsDraw(t,e),(i||void 0===i)&&(this.drawObject.once=!0),this.drawObject.draw()}else e.type.toLocaleLowerCase()==g.c.Line?(this.drawObject=new this.drawBase.LineDraw(t,e),this.drawObject.draw()):e.type.toLocaleLowerCase()==g.c.Area&&(this.drawObject=new this.drawBase.AreaDraw(t,e),this.drawObject.draw());this.drawMade||(this.drawMade=[]),this.drawMade.push(this.drawObject)}removeAllDraw(){if(this.drawMade){for(let t=0;t<this.drawMade.length;t++)this.drawMade[t].remove(!0);this.drawMade=null}}removeThisDraw(t){this.drawObject.remove(t)}static create(t){return O.instance||(O.instance=new O(t)),O.instance}}O.pluginName="MeasureAndDraw",O.instance=null;var B,D=O;!function(t){t.Right="right",t.Left="left",t.Up="up",t.Down="down",t.Front="front",t.Behind="behind"}(B||(B={}));class z extends n.a{constructor(t,e){super(t),this.engineVersion="3.0.1",this.version="0.01",this._boxMaterials={},this._boxMaterials_old={};const{Viewer:i}=n.a.easy3DAPI;let o;if(!(e=Object.assign({},{boxImgs:{},boxOpacity:.8,boxSelectColor:"rgba(243,204,111,1)",arrowColors:["red","green","blue"],textSize:16},e)).boxImgs)throw new Error("创建Navigator：boxImgs为必须参数！");this.options=e,this._boxSize=20,this.viewer=t,e.container?o=e.container:(o=document.createElement("div"),t.container.parentElement.appendChild(o),o.style.cssText="position: absolute;\n                top: 20px;\n                right: 20px;\n                height: 100px;\n                width: 100px",this._defaultElement=o),this.viewer_navigator=new i(o,{token:t.token,licenseUrl:t.licenseUrl,camera:{type:g.b.Perspective,fov:10,near:.01,far:1e4,position:[30,30,30],target:[0,0,0]},lights:{ambient:{color:"rgb(255,255,255)",intensity:.6},directionals:[{color:"rgb(255,255,255)",intensity:.5,position:[1,.8,2]},{color:"rgb(255,255,255)",intensity:.5,position:[-1,-.8,-2]}]},scene:{opacity:0}}),this._setCameraPos(),this.viewer_navigator.controls.orbitControl.enabled=!0,this.viewer_navigator.controls.orbitControl.enableZoom=!1,this._createArrow(),this._createText(),this._createBox(),this._navigatorMouseupCbHandler=this._navigatorMouseupCb.bind(this),this._viewerMouseCbHandler=this._viewerMouseCb.bind(this),this._navigatorViewerMouseCbHandler=this._navigatorViewerMouse.bind(this),this._initEvent(),this._viewerMouseCb({type:g.l.Mousemove})}navigator(t,e){return this.removeNavigator(),z.instance=new z(t,e)}removeNavigator(){if(z.instance)return z.instance.remove(),z.instance=null,this}remove(){for(const t of this.viewer_navigator.scene.children)this.viewer_navigator.remove(this.viewer_navigator.scene[t],!0);this._removeEvent(),this.viewer_navigator.container.removeChild(this.viewer_navigator.renderer.domElement),this.viewer_navigator.renderer.dispose(),this._defaultElement&&this._defaultElement.parentElement.removeChild(this._defaultElement),cancelAnimationFrame(this.viewer_navigator.animationId)}_createArrow(){const{THREE:t}=n.a.easy3DAPI,e=new t.Vector3(1,0,0),i=new t.Vector3(-this._boxSize/2,-this._boxSize/2,-this._boxSize/2),o=1.3*this._boxSize,s=new t.ArrowHelper(e,i,o,this.options.arrowColors[0],4,2),r=new t.Vector3(0,1,0),a=new t.ArrowHelper(r,i,o,this.options.arrowColors[1],4,2),l=new t.Vector3(0,0,1),h=new t.ArrowHelper(l,i,o,this.options.arrowColors[2],4,2);this._arrows=[s,a,h],this.viewer_navigator.add(this._arrows)}_createText(){const{THREE:t}=n.a.easy3DAPI;let e=.9*this._boxSize,i=[[e,-this._boxSize/2,-this._boxSize/2],[-this._boxSize/2,e,-this._boxSize/2],[-this._boxSize/2,-this._boxSize/2,e]].map(e=>(new t.BufferGeometry).setAttribute("position",new t.Float32BufferAttribute(e,3)));let o=["X","Y","Z"].map((e,i)=>{let n=new t.Texture(function(t,e){const i=document.createElement("canvas");i.width=i.height=64;let n=i.getContext("2d");return n.font="bold 38pt Arial",n.fillStyle=e,n.textAlign="center",n.textBaseline="middle",n.fillText(t,i.width/2,i.height/2),i}(e,this.options.arrowColors[i]));return n.needsUpdate=!0,new t.PointsMaterial({map:n,size:this.options.textSize,sizeAttenuation:!1,transparent:!0,opacity:1,alphaTest:.3})});this._particles=o.map((e,n)=>new t.Points(i[n],e)),this.viewer_navigator.add(this._particles)}_createBox(){const{THREE:t,Base:e}=n.a.easy3DAPI,i=new t.BoxGeometry(this._boxSize,this._boxSize,this._boxSize);let o=this.options.boxImgs;for(const t in o)this._boxMaterials[t]=e.standardMaterial({map:o[t],opacity:this.options.boxOpacity}),this._boxMaterials_old[t]={color:"rgb(255,255,255)",texture:o[t],opacity:this.options.boxOpacity};this._box=new t.Mesh(i,Object.values(this._boxMaterials)),this.viewer_navigator.add(this._box)}_navigatorMouseupCb(t){let e;t.intersect&&(t.intersect.faceIndex<=1?e=B.Right:t.intersect.faceIndex<=3?e=B.Left:t.intersect.faceIndex<=5?e=B.Up:t.intersect.faceIndex<=7?e=B.Down:t.intersect.faceIndex<=9?e=B.Front:t.intersect.faceIndex<=11&&(e=B.Behind),this._changeMaterial(e),this._oldDirection=e,this._changeFace(e))}_viewerMouseCb(t){const{THREE:e}=n.a.easy3DAPI;this.viewerConfig=this.viewer.configCamera();let i=new e.Vector3(this.viewerConfig.position[0],this.viewerConfig.position[1],this.viewerConfig.position[2]),o=new e.Vector3(this.viewerConfig.target[0],this.viewerConfig.target[1],this.viewerConfig.target[2]);this.multiple=i.distanceTo(o),t.type===g.l.Mousedown||t.type===g.l.Touchstart?this._oldDirection&&this._resetMaterial(this._oldDirection):t.type!==g.l.Mousemove&&t.type!==g.l.Touchmove||this._setCameraPos()}_navigatorViewerMouse(t){t.type===g.l.Mousedown||t.type===g.l.Touchstart?(this._oldDirection&&this._resetMaterial(this._oldDirection),this.mousedownFlag=!0):t.type===g.l.Mousemove||t.type===g.l.Touchmove?this.mousedownFlag&&this._setViewCameraPos():t.type!==g.l.Mouseup&&t.type!==g.l.Touchend||(this.mousedownFlag=!1)}_initEvent(){this.viewer_navigator.on(g.l.Dblclick,this._navigatorMouseupCbHandler,{target:this._box}),this.viewer_navigator.on(g.l.Mousedown,this._navigatorViewerMouseCbHandler),this.viewer_navigator.on(g.l.Mousemove,this._navigatorViewerMouseCbHandler),this.viewer_navigator.on(g.l.Mouseup,this._navigatorViewerMouseCbHandler),this.viewer.on(g.l.Mousedown,this._viewerMouseCbHandler),this.viewer.on(g.l.Mousemove,this._viewerMouseCbHandler),this.viewer_navigator.on(g.l.Touchstart,this._navigatorViewerMouseCbHandler),this.viewer_navigator.on(g.l.Touchmove,this._navigatorViewerMouseCbHandler),this.viewer_navigator.on(g.l.Touchend,this._navigatorViewerMouseCbHandler),this.viewer.on(g.l.Touchstart,this._viewerMouseCbHandler),this.viewer.on(g.l.Touchmove,this._viewerMouseCbHandler)}_removeEvent(){this.viewer_navigator.off(g.l.Dblclick,this._navigatorMouseupCbHandler,{target:this._box}),this.viewer_navigator.off(g.l.Mousedown,this._navigatorViewerMouseCbHandler),this.viewer_navigator.off(g.l.Mousemove,this._navigatorViewerMouseCbHandler),this.viewer_navigator.off(g.l.Mouseup,this._navigatorViewerMouseCbHandler),this.viewer.off(g.l.Mousedown,this._viewerMouseCbHandler),this.viewer.off(g.l.Mousemove,this._viewerMouseCbHandler),this.viewer_navigator.off(g.l.Touchstart,this._navigatorViewerMouseCbHandler),this.viewer_navigator.off(g.l.Touchmove,this._navigatorViewerMouseCbHandler),this.viewer_navigator.off(g.l.Touchend,this._navigatorViewerMouseCbHandler),this.viewer.off(g.l.Touchstart,this._viewerMouseCbHandler),this.viewer.off(g.l.Touchmove,this._viewerMouseCbHandler)}_changeMaterial(t){const{Base:e}=n.a.easy3DAPI;this._oldDirection&&this._resetMaterial(this._oldDirection),e.configStandardMaterial(this._boxMaterials[t],{color:this.options.boxSelectColor})}_changeFace(t){const{THREE:e}=n.a.easy3DAPI;let i=this.viewer.configCamera(),o=new e.Vector3(i.position[0],i.position[1],i.position[2]),s=new e.Vector3(i.target[0],i.target[1],i.target[2]),r=o.distanceTo(s);switch(t){case B.Right:this.viewer.configCamera({position:[r+i.target[0],i.target[1],i.target[2]]});break;case B.Left:this.viewer.configCamera({position:[-r+i.target[0],i.target[1],i.target[2]]});break;case B.Up:this.viewer.configCamera({position:[i.target[0],r+i.target[0],i.target[2]]});break;case B.Down:this.viewer.configCamera({position:[i.target[0],-r+i.target[0],i.target[2]]});break;case B.Front:this.viewer.configCamera({position:[i.target[0],i.target[1],r+i.target[0]]});break;case B.Behind:this.viewer.configCamera({position:[i.target[0],i.target[1],-r+i.target[0]]})}this._setCameraPos()}_resetMaterial(t){const{Base:e}=n.a.easy3DAPI;e.configStandardMaterial(this._boxMaterials[t],this._boxMaterials_old[t])}_setCameraPos(){const{THREE:t}=n.a.easy3DAPI;let e=this.viewer.configCamera(),i=new t.Vector3(e.position[0],e.position[1],e.position[2]),o=new t.Vector3(e.target[0],e.target[1],e.target[2]),s=i.sub(o).normalize();this.viewer_navigator.configCamera({position:[300*s.x,300*s.y,300*s.z]})}_setViewCameraPos(){const{THREE:t}=n.a.easy3DAPI;let e=this.viewer_navigator.configCamera(),i=new t.Vector3(e.position[0],e.position[1],e.position[2]),o=new t.Vector3(this.viewerConfig.target[0],this.viewerConfig.target[1],this.viewerConfig.target[2]),s=i.sub(o).normalize();this.viewer.configCamera({position:[s.x*this.multiple,s.y*this.multiple,s.z*this.multiple]})}static create(t,e){return z.instance||(z.instance=new z(t,e)),z.instance}}z.pluginName="Navigator",z.instance=null;var E=z;class V extends n.a{constructor(t){super(t),this.engineVersion="3.0.1",this.version="0.01";const{Util:e}=n.a.easy3DAPI;this._tfControl=e.configTransformControl()}align(t,e){const i=this._calcAlignData(t);this._tfControl&&(this._tfControl.setUAR_Data(t),this._tfControl.UAR.revokeAdd=!0),i.centers.forEach((n,o)=>{t[o].object3d.position.add(this._calcOffset(t[o],e,i.boxCenter,n))}),this._tfControl&&(this._tfControl.UAR.revokeAdd=!0,this._tfControl.UAR.revokeMake())}modelEquipartition(t,e){const{THREE:i,Model:o}=n.a.easy3DAPI;if(t.length<=1)throw new Error("modelArrangement方法：models必须传入Model对象数组，且长度必须大于1！");this._tfControl&&(this._tfControl.setUAR_Data(t),this._tfControl.UAR.revokeAdd=!0),e=e.toLocaleLowerCase();let s=[],r=[],a=[],l=[],h=[],c=[];const p=e.includes("x"),u=e.includes("y"),d=e.includes("z");if(!p||u||d)if(p||!u||d)if(p||u||!d){if(!p&&!u&&!d)throw new Error("modelArrangement方法：axis参数必须传入由字符x、X、y、Y、z、Z组成的字符串")}else t=f(t,2);else t=f(t,1);else t=f(t,0);function f(t,e){let i=t.map(t=>[t.transform().position[e],t]);return i.sort((t,e)=>t[0]-e[0]),i.map(t=>t[1])}function v(t,e){let i=Math.min(...t),n=(Math.max(...t)-i)/(t.length-1);return t.map((t,o)=>i+n*o-e[o])}t.forEach(t=>{if(!(t instanceof o))throw new Error("modelArrangement方法：models必须传入Model对象数组！");const e=(new i.Box3).setFromObject(t.object3d).getCenter(new i.Vector3).toArray();let n=t.transform().position;l.push(e[0]-n[0]),h.push(e[1]-n[1]),c.push(e[2]-n[2]),s.push(p?e[0]:n[0]),r.push(u?e[1]:n[1]),a.push(d?e[2]:n[2])}),p&&(s=v(s,l)),u&&(r=v(r,h)),d&&(a=v(a,c)),t.forEach((t,e)=>t.transform({position:[s[e],r[e],a[e]]})),this._tfControl&&(this._tfControl.UAR.revokeAdd=!0,this._tfControl.UAR.revokeMake())}_calcAlignData(t){const{THREE:e}=n.a.easy3DAPI,i=new e.Vector3,o=[];return t.forEach(t=>{const n=(new e.Box3).setFromObject(t.object3d).getCenter(new e.Vector3);o.push(n),i.add(n.clone())}),i.divideScalar(t.length),{boxCenter:i,centers:o}}_calcOffset(t,e,i,o){const{THREE:s}=n.a.easy3DAPI;let r;const a=t.object3d.matrixWorld.extractRotation(new s.Matrix4);switch(e.toLocaleLowerCase()){case g.a.X:const t=new s.Vector3(1,0,0);t.applyMatrix4(a.invert()),r=new s.Vector3(t.x,0,0).normalize(),r.multiplyScalar(i.x-o.x);break;case g.a.Y:const e=new s.Vector3(0,1,0);e.applyMatrix4(a.invert()),r=new s.Vector3(0,e.y,0).normalize(),r.multiplyScalar(i.y-o.y);break;case g.a.Z:const n=new s.Vector3(0,0,1);n.applyMatrix4(a.invert()),r=new s.Vector3(0,0,n.z).normalize(),r.multiplyScalar(i.z-o.z);break;case g.a.Center:r=i.clone().sub(o)}return r}static create(t,e){return V.instance||(V.instance=new V(t)),V.instance}}V.pluginName="Align",V.instance=null;var T=V,L=i(10),j=i.n(L),I=i(36),R=i.n(I);function U(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function F(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?U(Object(i),!0).forEach((function(e){j()(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):U(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function H(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=h()(t);if(e){var o=h()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return a()(this,i)}}function N(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return G(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return G(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return r=t.done,t},e:function(t){a=!0,s=t},f:function(){try{r||null==i.return||i.return()}finally{if(a)throw s}}}}function G(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var q=function(t){var e,i,n,o,r=t.BufferAttribute,a=t.Vector3,l=t.Vector2,h=t.Plane,c=t.Line3,u=t.Triangle,f=t.Sphere,v=t.Matrix4,g=t.BackSide,m=t.DoubleSide,w=t.Box3,y=t.FrontSide,_=Math.pow(2,-24),b=new a,x=new a,M=new a,P=new l,C=new l,A=new l,S=new a,k=[],O=d()((function t(){p()(this,t)}));function B(t,e,i){return i.min.x=e[t],i.min.y=e[t+1],i.min.z=e[t+2],i.max.x=e[t+3],i.max.y=e[t+4],i.max.z=e[t+5],i}function D(t){for(var e=-1,i=-1/0,n=0;n<3;n++){var o=t[n+3]-t[n];o>i&&(i=o,e=n)}return e}function z(t,e){e.set(t)}function E(t,e,i){for(var n,o,s=0;s<3;s++){var r=s+3;n=t[s],o=e[s],i[s]=n<o?n:o,n=t[r],o=e[r],i[r]=n>o?n:o}}function V(t,e,i){for(var n=0;n<3;n++){var o=e[t+2*n],s=e[t+2*n+1],r=o-s,a=o+s;r<i[n]&&(i[n]=r),a>i[n+3]&&(i[n+3]=a)}}function T(t){var e=t[3]-t[0],i=t[4]-t[1],n=t[5]-t[2];return 2*(e*i+i*n+n*e)}function L(t,e,i,n,o,s){var r=-1,a=0;if(0===s)-1!==(r=D(e))&&(a=(e[r]+e[r+3])/2);else if(1===s)-1!==(r=D(t))&&(a=function(t,e,i,n){for(var o=0,s=e,r=e+i;s<r;s++)o+=t[6*s+2*n];return o/i}(i,n,o,r));else if(2===s)for(var l=T(t),h=1.25*o,c=6*n,p=6*(n+o),u=0;u<3;u++){var d=e[u],f=(e[u+3]-d)/32;if(o<8){var v=R()(sahBins);v.length=o;for(var g=0,m=c;m<p;m+=6,g++){var w=v[g];w.candidate=i[m+2*u],w.count=0;for(var y=w.bounds,_=w.leftCacheBounds,b=w.rightCacheBounds,x=0;x<3;x++)b[x]=1/0,b[x+3]=-1/0,_[x]=1/0,_[x+3]=-1/0,y[x]=1/0,y[x+3]=-1/0;V(m,i,y)}v.sort(binsSort);for(var M=o,P=0;P<M;P++)for(var C=v[P];P+1<M&&v[P+1].candidate===C.candidate;)v.splice(P+1,1),M--;for(var A=c;A<p;A+=6)for(var S=i[A+2*u],k=0;k<M;k++){var O=v[k];S>=O.candidate?V(A,i,O.rightCacheBounds):(V(A,i,O.leftCacheBounds),O.count++)}for(var B=0;B<M;B++){var L=v[B],j=L.count,I=o-L.count,U=L.leftCacheBounds,F=L.rightCacheBounds,H=0;0!==j&&(H=T(U)/l);var N=0;0!==I&&(N=T(F)/l);var G=1+1.25*(H*j+N*I);G<h&&(r=u,h=G,a=L.candidate)}}else{for(var q=0;q<32;q++){var W=sahBins[q];W.count=0,W.candidate=d+f+q*f;for(var X=W.bounds,Q=0;Q<3;Q++)X[Q]=1/0,X[Q+3]=-1/0}for(var Y=c;Y<p;Y+=6){var K=~~((i[Y+2*u]-d)/f);K>=32&&(K=31);var Z=sahBins[K];Z.count++,V(Y,i,Z.bounds)}var $=sahBins[31];z($.bounds,$.rightCacheBounds);for(var J=30;J>=0;J--){var tt=sahBins[J],et=sahBins[J+1];E(tt.bounds,et.rightCacheBounds,tt.rightCacheBounds)}for(var it=0,nt=0;nt<31;nt++){var ot=sahBins[nt],st=ot.count,rt=ot.bounds,at=sahBins[nt+1].rightCacheBounds;0!==st&&(0===it?z(rt,leftBounds):E(rt,leftBounds,leftBounds));var lt=0,ht=0;0!==(it+=st)&&(lt=T(leftBounds)/l);var ct=o-it;0!==ct&&(ht=T(at)/l);var pt=1+1.25*(lt*it+ht*ct);pt<h&&(r=u,h=pt,a=ot.candidate)}}}else console.warn("MeshBVH: Invalid build strategy value ".concat(s," used."));return{axis:r,pos:a}}function I(t,e,i,n,o){for(var s=i,r=i+n-1,a=o.pos,l=2*o.axis;;){for(;s<=r&&e[6*s+l]<a;)s++;for(;s<=r&&e[6*r+l]>=a;)r--;if(!(s<r))return s;for(var h=0;h<3;h++){var c=t[3*s+h];t[3*s+h]=t[3*r+h],t[3*r+h]=c;var p=e[6*s+2*h+0];e[6*s+2*h+0]=e[6*r+2*h+0],e[6*r+2*h+0]=p;var u=e[6*s+2*h+1];e[6*s+2*h+1]=e[6*r+2*h+1],e[6*r+2*h+1]=u}s++,r--}}function U(t,e,i,n){for(var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=1/0,r=1/0,a=1/0,l=-1/0,h=-1/0,c=-1/0,p=1/0,u=1/0,d=1/0,f=-1/0,v=-1/0,g=-1/0,m=null!==o,w=6*e,y=6*(e+i);w<y;w+=6){var _=t[w+0],b=t[w+1],x=_-b,M=_+b;x<s&&(s=x),M>l&&(l=M),m&&_<p&&(p=_),m&&_>f&&(f=_);var P=t[w+2],C=t[w+3],A=P-C,S=P+C;A<r&&(r=A),S>h&&(h=S),m&&P<u&&(u=P),m&&P>v&&(v=P);var k=t[w+4],O=t[w+5],B=k-O,D=k+O;B<a&&(a=B),D>c&&(c=D),m&&k<d&&(d=k),m&&k>g&&(g=k)}n[0]=s,n[1]=r,n[2]=a,n[3]=l,n[4]=h,n[5]=c,m&&(o[0]=p,o[1]=u,o[2]=d,o[3]=f,o[4]=v,o[5]=g)}function G(t,e){function i(t){d&&d(t/f)}function n(e,o,r){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!v&&f>=h&&(v=!0,c&&(console.warn("MeshBVH: Max depth of ".concat(h," reached when generating BVH. Consider increasing maxDepth.")),console.warn(t))),r<=p||f>=h)return i(o+r),e.offset=o,e.count=r,e;var g=L(e.boundingData,d,a,o,r,u);if(-1===g.axis)return i(o+r),e.offset=o,e.count=r,e;var m=I(l,a,o,r,g);if(m===o||m===o+r)i(o+r),e.offset=o,e.count=r;else{e.splitAxis=g.axis;var w=new O,y=o,_=m-o;e.left=w,w.boundingData=new Float32Array(6),U(a,y,_,w.boundingData,s),n(w,y,_,s,f+1);var b=new O,x=m,M=r-_;e.right=b,b.boundingData=new Float32Array(6),U(a,x,M,b.boundingData,s),n(b,x,M,s,f+1)}return e}!function(t,e){if(!t.index){var i,n=t.attributes.position.count,o=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;i=n>65535?new Uint32Array(new o(4*n)):new Uint16Array(new o(2*n)),t.setIndex(new r(i,1));for(var s=0;s<n;s++)i[s]=s}}(t,e);var o=new Float32Array(6),s=new Float32Array(6),a=function(t,e){var i=t.attributes.position,n=t.index.array,o=n.length/3,s=new Float32Array(6*o),r=i.normalized,a=i.array,l=i.offset||0,h=3;i.isInterleavedBufferAttribute&&(h=i.data.stride);for(var c=["getX","getY","getZ"],p=0;p<o;p++){var u=3*p,d=6*p,f=void 0,v=void 0,g=void 0;r?(f=n[u+0],v=n[u+1],g=n[u+2]):(f=n[u+0]*h+l,v=n[u+1]*h+l,g=n[u+2]*h+l);for(var m=0;m<3;m++){var w=void 0,y=void 0,b=void 0;r?(w=i[c[m]](f),y=i[c[m]](v),b=i[c[m]](g)):(w=a[f+m],y=a[v+m],b=a[g+m]);var x=w;y<x&&(x=y),b<x&&(x=b);var M=w;y>M&&(M=y),b>M&&(M=b);var P=(M-x)/2,C=2*m;s[d+C+0]=x+P,s[d+C+1]=P+(Math.abs(x)+P)*_,x<e[m]&&(e[m]=x),M>e[m+3]&&(e[m+3]=M)}}return s}(t,o),l=t.index.array,h=e.maxDepth,c=e.verbose,p=e.maxLeafTris,u=e.strategy,d=e.onProgress,f=t.index.count/3,v=!1,g=[],m=function(t){if(!t.groups||!t.groups.length)return[{offset:0,count:t.index.count/3}];var e,i=[],n=new Set,o=N(t.groups);try{for(o.s();!(e=o.n()).done;){var s=e.value;n.add(s.start),n.add(s.start+s.count)}}catch(t){o.e(t)}finally{o.f()}for(var r=Array.from(n.values()).sort((function(t,e){return t-e})),a=0;a<r.length-1;a++){var l=r[a],h=r[a+1];i.push({offset:l/3,count:(h-l)/3})}return i}(t);if(1===m.length){var w=m[0],y=new O;y.boundingData=o,function(t,e,i,n){for(var o=1/0,s=1/0,r=1/0,a=-1/0,l=-1/0,h=-1/0,c=6*e,p=6*(e+i);c<p;c+=6){var u=t[c+0];u<o&&(o=u),u>a&&(a=u);var d=t[c+2];d<s&&(s=d),d>l&&(l=d);var f=t[c+4];f<r&&(r=f),f>h&&(h=f)}n[0]=o,n[1]=s,n[2]=r,n[3]=a,n[4]=l,n[5]=h}(a,w.offset,w.count,s),n(y,w.offset,w.count,s),g.push(y)}else{var b,x=N(m);try{for(x.s();!(b=x.n()).done;){var M=b.value,P=new O;P.boundingData=new Float32Array(6),U(a,M.offset,M.count,P.boundingData,s),n(P,M.offset,M.count,s),g.push(P)}}catch(t){x.e(t)}finally{x.f()}}return g}function q(t,e){for(var i,n,o,s=G(t,e),r=[],a=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,l=0;l<s.length;l++){var h=s[l],c=new a(32*p(h));i=new Float32Array(c),n=new Uint32Array(c),o=new Uint16Array(c),u(0,h),r.push(c)}return r;function p(t){return t.count?1:1+p(t.left)+p(t.right)}function u(t,e){for(var s=t/4,r=t/2,a=!!e.count,l=e.boundingData,h=0;h<6;h++)i[s+h]=l[h];if(a){var c=e.offset,p=e.count;return n[s+6]=c,o[r+14]=p,o[r+15]=65535,t+32}var d,f=e.left,v=e.right,g=e.splitAxis;if((d=u(t+32,f))/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[s+6]=d/4,d=u(d,v),n[s+7]=g,d}}function W(t,e){return 65535===e[t+15]}function X(t,e){return e[t+6]}function Q(t,e){return e[t+14]}function Y(t){return t+8}function K(t,e){return e[t+6]}function Z(t){e&&k.push(e),e=t,i=new Float32Array(t),n=new Uint16Array(t),o=new Uint32Array(t)}function $(t,e,i,n,o){var s=3*n,r=t.index.getX(s),h=t.index.getX(s+1),c=t.index.getX(s+2),p=function(t,e,i,n,o,s,r){b.fromBufferAttribute(e,n),x.fromBufferAttribute(e,o),M.fromBufferAttribute(e,s);var h=function(t,e,i,n,o,s){var r;r=s===g?t.intersectTriangle(n,i,e,!0,o):t.intersectTriangle(e,i,n,s!==m,o);return null===r?null:{distance:t.origin.distanceTo(o),point:o.clone()}}(t,b,x,M,S,r);if(h){i&&(P.fromBufferAttribute(i,n),C.fromBufferAttribute(i,o),A.fromBufferAttribute(i,s),h.uv=u.getUV(S,b,x,M,P,C,A,new l));var c={a:n,b:o,c:s,normal:new a,materialIndex:0};u.getNormal(b,x,M,c.normal),h.face=c,h.faceIndex=n}return h}(i,t.attributes.position,t.attributes.uv,r,h,c,e);return p?(p.faceIndex=n,o&&o.push(p),p):null}function J(t,e,s,r,a){var l=2*t,h=i,c=n,p=o;if(W(l,c)){!function(t,e,i,n,o,s){for(var r=n,a=n+o;r<a;r++)$(t,e,i,r,s)}(e,s,r,X(t,p),Q(l,c),a)}else{var u=Y(t);et(u,h,r,boxIntersection)&&J(u,e,s,r,a);var d=K(t,p);et(d,h,r,boxIntersection)&&J(d,e,s,r,a)}}function tt(){e=null,i=null,n=null,o=null,k.length&&Z(k.pop())}function et(t,e,i,n){return B(t,e,boundingBox$1),i.intersectBox(boundingBox$1,n)}function it(t,e,s,r){var a=2*t,l=i,h=n,c=o;if(W(a,h))return function(t,e,i,n,o){for(var s=1/0,r=null,a=n,l=n+o;a<l;a++){var h=$(t,e,i,a);h&&h.distance<s&&(r=h,s=h.distance)}return r}(e,s,r,X(t,c),Q(a,h));var p,u,d=function(t,e){return e[t+7]}(t,c),f=xyzFields[d],v=r.direction[f]>=0;v?(p=Y(t),u=K(t,c)):(p=K(t,c),u=Y(t));var g=et(p,l,r,boxIntersection)?it(p,e,s,r):null;if(g){var m=g.point[f];if(v?m<=l[u+d]:m>=l[u+d+3])return g}var w=et(u,l,r,boxIntersection)?it(u,e,s,r):null;return g&&w?g.distance<=w.distance?g:w:g||w||null}function nt(t,e,i,n,o,s,r){for(var a=i.index,l=i.attributes.position,h=t,c=e+t;h<c;h++)if(ot(r,3*h,a,l),r.needsUpdate=!0,n(r,h,o,s))return!0;return!1}function ot(t,e,i,n){var o=t.a,s=t.b,r=t.c,a=e,l=e+1,h=e+2;i&&(a=i.getX(e),l=i.getX(e+1),h=i.getX(e+2)),o.x=n.getX(a),o.y=n.getY(a),o.z=n.getZ(a),s.x=n.getX(l),s.y=n.getY(l),s.z=n.getZ(l),r.x=n.getX(h),r.y=n.getY(h),r.z=n.getZ(h)}var st,rt,at,lt,ht,ct,pt=function(){function t(e){p()(this,t),this._getNewPrimitive=e,this._primitives=[]}return d()(t,[{key:"getPrimitive",value:function(){var t=this._primitives;return 0===t.length?this._getNewPrimitive():t.pop()}},{key:"releasePrimitive",value:function(t){this._primitives.push(t)}}]),t}(),ut=function(){function t(){p()(this,t),this.min=1/0,this.max=-1/0}return d()(t,[{key:"setFromPointsField",value:function(t,e){for(var i=1/0,n=-1/0,o=0,s=t.length;o<s;o++){var r=t[o][e];i=r<i?r:i,n=r>n?r:n}this.min=i,this.max=n}},{key:"setFromPoints",value:function(t,e){for(var i=1/0,n=-1/0,o=0,s=e.length;o<s;o++){var r=e[o],a=t.dot(r);i=a<i?a:i,n=a>n?a:n}this.min=i,this.max=n}},{key:"isSeparated",value:function(t){return this.min>t.max||t.min>this.max}}]),t}(),dt=(st=new a,rt=new a,at=new a,function(t,e,i){var n=t.start,o=st,s=e.start,r=rt;at.subVectors(n,s),st.subVectors(t.end,t.start),rt.subVectors(e.end,e.start);var a,l,h=at.dot(r),c=r.dot(o),p=r.dot(r),u=at.dot(o),d=o.dot(o)*p-c*c;l=(h+(a=0!==d?(h*c-u*p)/d:0)*c)/p,i.x=a,i.y=l}),ft=function(){var t=new l,e=new a,i=new a;return function(n,o,s,r){dt(n,o,t);var a,l,h=t.x,c=t.y;if(h>=0&&h<=1&&c>=0&&c<=1)return n.at(h,s),void o.at(c,r);if(h>=0&&h<=1)return c<0?o.at(0,r):o.at(1,r),void n.closestPointToPoint(r,!0,s);if(c>=0&&c<=1)return h<0?n.at(0,s):n.at(1,s),void o.closestPointToPoint(s,!0,r);a=h<0?n.start:n.end,l=c<0?o.start:o.end;var p=e,u=i;return n.closestPointToPoint(l,!0,e),o.closestPointToPoint(a,!0,i),p.distanceToSquared(l)<=u.distanceToSquared(a)?(s.copy(p),void r.copy(l)):(s.copy(a),void r.copy(u))}}(),vt=function(t){s()(i,t);var e=H(i);function i(){var t;p()(this,i);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(t=e.call.apply(e,[this].concat(o))).isExtendedTriangle=!0,t.satAxes=new Array(4).fill().map((function(){return new a})),t.satBounds=new Array(4).fill().map((function(){return new ut})),t.points=[t.a,t.b,t.c],t.sphere=new f,t.plane=new h,t.needsUpdate=!0,t}return d()(i,[{key:"intersectsSphere",value:function(t){return Mt(t,this)}},{key:"update",value:function(){var t=this.a,e=this.b,i=this.c,n=this.points,o=this.satAxes,s=this.satBounds,r=o[0],a=s[0];this.getNormal(r),a.setFromPoints(r,n);var l=o[1],h=s[1];l.subVectors(t,e),h.setFromPoints(l,n);var c=o[2],p=s[2];c.subVectors(e,i),p.setFromPoints(c,n);var u=o[3],d=s[3];u.subVectors(i,t),d.setFromPoints(u,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(r,t),this.needsUpdate=!1}}]),i}(u);vt.prototype.closestPointToSegment=(lt=new a,ht=new a,ct=new c,function(t){for(var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=t.start,s=t.end,r=this.points,a=1/0,l=0;l<3;l++){var h=(l+1)%3;ct.start.copy(r[l]),ct.end.copy(r[h]),ft(ct,t,lt,ht),(e=lt.distanceToSquared(ht))<a&&(a=e,i&&i.copy(lt),n&&n.copy(ht))}return this.closestPointToPoint(o,lt),(e=o.distanceToSquared(lt))<a&&(a=e,i&&i.copy(lt),n&&n.copy(o)),this.closestPointToPoint(s,lt),(e=s.distanceToSquared(lt))<a&&(a=e,i&&i.copy(lt),n&&n.copy(s)),Math.sqrt(a)});var gt,mt,wt,yt,_t=function(){function t(e,i,n){p()(this,t),this.isOrientedBox=!0,this.min=new a,this.max=new a,this.matrix=new v,this.invMatrix=new v,this.points=new Array(8).fill().map((function(){return new a})),this.satAxes=new Array(3).fill().map((function(){return new a})),this.satBounds=new Array(3).fill().map((function(){return new ut})),this.alignedSatBounds=new Array(3).fill().map((function(){return new ut})),this.needsUpdate=!1,e&&this.min.copy(e),i&&this.max.copy(i),n&&this.matrix.copy(n)}return d()(t,[{key:"set",value:function(t,e,i){this.min.copy(t),this.max.copy(e),this.matrix.copy(i),this.needsUpdate=!0}},{key:"copy",value:function(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}}]),t}(),bt=function(){var t=new vt,e=new vt,s=new v,r=new _t,a=new _t;return function l(h,c,p,u){var d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=2*h,v=i,g=n,m=o;null===d&&(p.boundingBox||p.computeBoundingBox(),r.set(p.boundingBox.min,p.boundingBox.max,u),d=r);var w=W(f,g);if(!w){var y=h+8,_=m[h+6];B(y,v,boundingBox$1);var b=d.intersectsBox(boundingBox$1)&&l(y,c,p,u,d);if(b)return!0;B(_,v,boundingBox$1);var x=d.intersectsBox(boundingBox$1)&&l(_,c,p,u,d);return!!x}var M=c,P=M.index,C=M.attributes.position,A=p.index,S=p.attributes.position,k=X(h,m),O=Q(f,g);if(s.copy(u).invert(),p.boundsTree){B(h,v,a),a.matrix.copy(s),a.needsUpdate=!0;var D=p.boundsTree.shapecast({intersectsBounds:function(t){return a.intersectsBox(t)},intersectsTriangle:function(t){t.a.applyMatrix4(u),t.b.applyMatrix4(u),t.c.applyMatrix4(u),t.needsUpdate=!0;for(var i=3*k,n=3*(O+k);i<n;i+=3)if(ot(e,i,P,C),e.needsUpdate=!0,t.intersectsTriangle(e))return!0;return!1}});return D}for(var z=3*k,E=O+3*k;z<E;z+=3){ot(t,z,P,C),t.a.applyMatrix4(s),t.b.applyMatrix4(s),t.c.applyMatrix4(s),t.needsUpdate=!0;for(var V=0,T=A.count;V<T;V+=3)if(ot(e,V,A,S),e.needsUpdate=!0,t.intersectsTriangle(e))return!0}}}(),xt=function(){var t,e,s=[],r=new pt((function(){return new w}));return function(){t=r.getPrimitive(),e=r.getPrimitive(),s.push(t,e);var i=a.apply(void 0,arguments);r.releasePrimitive(t),r.releasePrimitive(e),s.pop(),s.pop();var n=s.length;return n>0&&(e=s[n-1],t=s[n-2]),i};function a(s,r,l,h){var c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;function d(t){for(var e=2*t,i=n,s=o;!W(e,i);)e=2*(t=Y(t));return X(t,s)}function f(t){for(var e=2*t,i=n,s=o;!W(e,i);)e=2*(t=K(t,s));return X(t,s)+Q(e,i)}var v=2*s,g=i,m=n,w=o,y=W(v,m);if(y){var _=X(s,w),b=Q(v,m);return B(s,g,t),h(_,b,!1,u,p+s,t)}var x,M,P,C,A=Y(s),S=K(s,w),k=A,O=S;if(c&&(C=e,B(k,g,P=t),B(O,g,C),x=c(P),(M=c(C))<x)){k=S,O=A;var D=x;x=M,M=D,P=C}P||B(k,g,P=t);var z,E=W(2*k,m),V=l(P,E,x,u+1,p+k);if(2===V){var T=d(k),L=f(k),j=L-T;z=h(T,j,!0,u+1,p+k,P)}else z=V&&a(k,r,l,h,c,p,u+1);if(z)return!0;B(O,g,C=e);var I,R=W(2*O,m),U=l(C,R,M,u+1,p+O);if(2===U){var F=d(O),H=f(O),N=H-F;I=h(F,N,!0,u+1,p+O,C)}else I=U&&a(O,r,l,h,c,p,u+1);return!!I}}(),Mt=(gt=new a,mt=new a,wt=new h,yt=new c,function(t,e){var i=t.radius,n=t.center,o=e.a,s=e.b,r=e.c;if(yt.start=o,yt.end=s,yt.closestPointToPoint(n,!0,gt).distanceTo(n)<=i)return!0;if(yt.start=o,yt.end=r,yt.closestPointToPoint(n,!0,gt).distanceTo(n)<=i)return!0;if(yt.start=s,yt.end=r,yt.closestPointToPoint(n,!0,gt).distanceTo(n)<=i)return!0;var a=e.getPlane(wt);if(Math.abs(a.distanceToPoint(n))<=i){var l=a.projectPoint(n,mt);if(e.containsPoint(l))return!0}return!1}),Pt=Symbol("skip tree generation"),Ct=new w,At=new w,St=new v,kt=new _t,Ot=new _t,Bt=new a,Dt=new a,zt=new a,Et=new a,Vt=new a,Tt=new w,Lt=new pt((function(){return new vt}));return function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(p()(this,t),!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((i=Object.assign(j()({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null},Pt,!1),i)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,i[Pt]||(this._roots=q(e,i),!e.boundingBox&&i.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new w))),this.geometry=e}return d()(t,[{key:"refit",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t&&Array.isArray(t)&&(t=new Set(t));for(var e,i,n,o,s=this.geometry,r=s.index.array,a=s.attributes.position,l=0,h=this._roots,c=0,p=h.length;c<p;c++)e=h[c],i=new Uint32Array(e),n=new Uint16Array(e),o=new Float32Array(e),u(0,l),l+=e.byteLength;function u(e,s){var l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=2*e,c=65535===n[h+15];if(c){for(var p=i[e+6],d=n[h+14],f=1/0,v=1/0,g=1/0,m=-1/0,w=-1/0,y=-1/0,_=3*p,b=3*(p+d);_<b;_++){var x=r[_],M=a.getX(x),P=a.getY(x),C=a.getZ(x);M<f&&(f=M),M>m&&(m=M),P<v&&(v=P),P>w&&(w=P),C<g&&(g=C),C>y&&(y=C)}return(o[e+0]!==f||o[e+1]!==v||o[e+2]!==g||o[e+3]!==m||o[e+4]!==w||o[e+5]!==y)&&(o[e+0]=f,o[e+1]=v,o[e+2]=g,o[e+3]=m,o[e+4]=w,o[e+5]=y,!0)}var A=e+8,S=i[e+6],k=A+s,O=S+s,B=l,D=!1,z=!1;t?B||(D=t.has(k),z=t.has(O),B=!D&&!z):(D=!0,z=!0);var E=B||D,V=B||z,T=!1;E&&(T=u(A,s,B));var L=!1;V&&(L=u(S,s,B));var j=T||L;if(j)for(var I=0;I<3;I++){var R=A+I,U=S+I,F=o[R],H=o[R+3],N=o[U],G=o[U+3];o[e+I]=F<N?F:N,o[e+I+3]=H>G?H:G}return j}}},{key:"traverse",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this._roots[e],n=new Uint32Array(i),o=new Uint16Array(i);function s(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=2*e,l=65535===o[a+15];if(l){var h=n[e+6],c=o[a+14];t(r,l,new Float32Array(i,4*e,6),h,c)}else{var p=e+8,u=n[e+6],d=n[e+7],f=t(r,l,new Float32Array(i,4*e,6),d);f||(s(p,r+1),s(u,r+1))}}s(0)}},{key:"raycast",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y,i=this._roots,n=this.geometry,o=[],s=e.isMaterial,r=Array.isArray(e),a=n.groups,l=s?e.side:e,h=0,c=i.length;h<c;h++){var p=r?e[a[h].materialIndex].side:l,u=o.length;if(Z(i[h]),J(0,n,p,t,o),tt(),r)for(var d=a[h].materialIndex,f=u,v=o.length;f<v;f++)o[f].face.materialIndex=d}return o}},{key:"raycastFirst",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y,i=this._roots,n=this.geometry,o=e.isMaterial,s=Array.isArray(e),r=null,a=n.groups,l=o?e.side:e,h=0,c=i.length;h<c;h++){var p=s?e[a[h].materialIndex].side:l;Z(i[h]);var u=it(0,n,p,t);tt(),null!=u&&(null==r||u.distance<r.distance)&&(r=u,s&&(u.face.materialIndex=a[h].materialIndex))}return r}},{key:"intersectsGeometry",value:function(t,e){var i,n=this.geometry,o=!1,s=N(this._roots);try{for(s.s();!(i=s.n()).done;){if(Z(i.value),o=bt(0,n,t,e),tt(),o)break}}catch(t){s.e(t)}finally{s.f()}return o}},{key:"shapecast",value:function(t,e,i){var n=this.geometry;if(t instanceof Function){if(e){var o=e;e=function(t,e,i,n){var s=3*e;return o(t,s,s+1,s+2,i,n)}}t={boundsTraverseOrder:i,intersectsBounds:t,intersectsTriangle:e,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}var s=Lt.getPrimitive(),r=t,a=r.boundsTraverseOrder,l=r.intersectsBounds,h=r.intersectsRange,c=r.intersectsTriangle;if(h&&c){var p=h;h=function(t,e,i,o,r){return!!p(t,e,i,o,r)||nt(t,e,n,c,i,o,s)}}else h||(h=c?function(t,e,i,o){return nt(t,e,n,c,i,o,s)}:function(t,e,i){return i});var u,d=!1,f=0,v=N(this._roots);try{for(v.s();!(u=v.n()).done;){var g=u.value;if(Z(g),d=xt(0,n,l,h,a,f),tt(),d)break;f+=g.byteLength}}catch(t){v.e(t)}finally{v.f()}return Lt.releasePrimitive(s),d}},{key:"bvhcast",value:function(t,e,i){var n=i.intersectsRanges,o=i.intersectsTriangles,s=this.geometry.index,r=this.geometry.attributes.position,a=t.geometry.index,l=t.geometry.attributes.position;St.copy(e).invert();var h=Lt.getPrimitive(),c=Lt.getPrimitive();if(o){var p=function(t,i,n,p,u,d,f,v){for(var g=n,m=n+p;g<m;g++){ot(c,3*g,a,l),c.a.applyMatrix4(e),c.b.applyMatrix4(e),c.c.applyMatrix4(e),c.needsUpdate=!0;for(var w=t,y=t+i;w<y;w++)if(ot(h,3*w,s,r),h.needsUpdate=!0,o(h,c,w,g,u,d,f,v))return!0}return!1};if(n){var u=n;n=function(t,e,i,n,o,s,r,a){return!!u(t,e,i,n,o,s,r,a)||p(t,e,i,n,o,s,r,a)}}else n=p}t.getBoundingBox(At),At.applyMatrix4(e);var d=this.shapecast({intersectsBounds:function(t){return At.intersectsBox(t)},intersectsRange:function(e,i,o,s,r,a){return Ct.copy(a),Ct.applyMatrix4(St),t.shapecast({intersectsBounds:function(t){return Ct.intersectsBox(t)},intersectsRange:function(t,o,a,l,h){return n(e,i,t,o,s,r,l,h)}})}});return Lt.releasePrimitive(h),Lt.releasePrimitive(c),d}},{key:"intersectsBox",value:function(t,e){return kt.set(t.min,t.max,e),kt.needsUpdate=!0,this.shapecast({intersectsBounds:function(t){return kt.intersectsBox(t)},intersectsTriangle:function(t){return kt.intersectsTriangle(t)}})}},{key:"intersectsSphere",value:function(t){return this.shapecast({intersectsBounds:function(e){return t.intersectsBox(e)},intersectsTriangle:function(e){return e.intersectsSphere(t)}})}},{key:"closestPointToGeometry",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0;t.boundingBox||t.computeBoundingBox(),kt.set(t.boundingBox.min,t.boundingBox.max,e),kt.needsUpdate=!0;var r=this.geometry,a=r.attributes.position,l=r.index,h=t.attributes.position,c=t.index,p=Lt.getPrimitive(),u=Lt.getPrimitive(),d=Dt,f=zt,v=null,g=null;n&&(v=Et,g=Vt);var m=1/0,w=null,y=null;return St.copy(e).invert(),Ot.matrix.copy(St),this.shapecast({boundsTraverseOrder:function(t){return kt.distanceToBox(t)},intersectsBounds:function(t,e,i){return i<m&&i<s&&(e&&(Ot.min.copy(t.min),Ot.max.copy(t.max),Ot.needsUpdate=!0),!0)},intersectsRange:function(i,n){if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:function(t){return Ot.distanceToBox(t)},intersectsBounds:function(t,e,i){return i<m&&i<s},intersectsRange:function(t,s){for(var r=3*t,_=3*(t+s);r<_;r+=3){ot(u,r,c,h),u.a.applyMatrix4(e),u.b.applyMatrix4(e),u.c.applyMatrix4(e),u.needsUpdate=!0;for(var b=3*i,x=3*(i+n);b<x;b+=3){ot(p,b,l,a),p.needsUpdate=!0;var M=p.distanceToTriangle(u,d,v);if(M<m&&(f.copy(d),g&&g.copy(v),m=M,w=b/3,y=r/3),M<o)return!0}}}});for(var r=0,_=c?c.count:h.count;r<_;r+=3){ot(u,r,c,h),u.a.applyMatrix4(e),u.b.applyMatrix4(e),u.c.applyMatrix4(e),u.needsUpdate=!0;for(var b=3*i,x=3*(i+n);b<x;b+=3){ot(p,b,l,a),p.needsUpdate=!0;var M=p.distanceToTriangle(u,d,v);if(M<m&&(f.copy(d),g&&g.copy(v),m=M,w=b/3,y=r/3),M<o)return!0}}}}),Lt.releasePrimitive(p),Lt.releasePrimitive(u),m===1/0?null:(i.point?i.point.copy(f):i.point=f.clone(),i.distance=m,i.faceIndex=w,n&&(n.point?n.point.copy(g):n.point=g.clone(),n.point.applyMatrix4(St),f.applyMatrix4(St),n.distance=f.sub(n.point).length(),n.faceIndex=y),i)}},{key:"closestPointToPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,o=i*i,s=n*n,r=1/0,a=null;if(this.shapecast({boundsTraverseOrder:function(e){return Bt.copy(t).clamp(e.min,e.max),Bt.distanceToSquared(t)},intersectsBounds:function(t,e,i){return i<r&&i<s},intersectsTriangle:function(e,i){e.closestPointToPoint(t,Bt);var n=t.distanceToSquared(Bt);return n<r&&(Dt.copy(Bt),r=n,a=i),n<o}}),r===1/0)return null;var l=Math.sqrt(r);return e.point?e.point.copy(Dt):e.point=Dt.clone(),e.distance=l,e.faceIndex=a,e}},{key:"getBoundingBox",value:function(t){return t.makeEmpty(),this._roots.forEach((function(e){B(0,new Float32Array(e),Tt),t.union(Tt)})),t}}],[{key:"serialize",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(i.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),t.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});i=F({cloneBuffers:!0},i);var n=e.geometry,o=e._roots,s=n.getIndex();return i.cloneBuffers?{roots:o.map((function(t){return t.slice()})),index:s.array.slice()}:{roots:o,index:s.array}}},{key:"deserialize",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("boolean"==typeof n)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),t.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});n=F({setIndex:!0},n);var o=e.index,s=e.roots,a=new t(i,F(F({},n),{},j()({},Pt,!0)));if(a._roots=s,n.setIndex){var l=i.getIndex();if(null===l){var h=new r(e.index,1,!1);i.setIndex(h)}else l.array!==o&&(l.array.set(o),l.needsUpdate=!0)}return a}}]),t}()};function W(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=h()(t);if(e){var o=h()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return a()(this,i)}}const X=t=>{const{THREE:e,Loader:i}=t,n=q(t.THREE),o=function(t){var e=t.BoxGeometry,i=t.Vector3,n=new i;function o(t,e,i,o,s,r){var a=2*Math.PI*s/4,l=Math.max(r-2*s,0),h=Math.PI/4;n.copy(e),n[o]=0,n.normalize();var c=.5*a/(a+l),p=1-n.angleTo(t)/h;return 1===Math.sign(n[i])?p*c:l/(a+l)+c+c*(1-p)}return function(t){s()(n,t);var e=W(n);function n(){var t,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1;if(p()(this,n),h=2*h+1,c=Math.min(s/2,r/2,l/2,c),t=e.call(this,1,1,1,h,h,h),1===h)return a()(t);var u=t.toNonIndexed();t.index=null,t.attributes.position=u.attributes.position,t.attributes.normal=u.attributes.normal,t.attributes.uv=u.attributes.uv;for(var d=new i,f=new i,v=new i(s,r,l).divideScalar(2).subScalar(c),g=t.attributes.position.array,m=t.attributes.normal.array,w=t.attributes.uv.array,y=g.length/6,_=new i,b=.5/h,x=0,M=0;x<g.length;x+=3,M+=2){d.fromArray(g,x),f.copy(d),f.x-=Math.sign(f.x)*b,f.y-=Math.sign(f.y)*b,f.z-=Math.sign(f.z)*b,f.normalize(),g[x+0]=v.x*Math.sign(d.x)+f.x*c,g[x+1]=v.y*Math.sign(d.y)+f.y*c,g[x+2]=v.z*Math.sign(d.z)+f.z*c,m[x+0]=f.x,m[x+1]=f.y,m[x+2]=f.z;var P=Math.floor(x/y);switch(P){case 0:_.set(1,0,0),w[M+0]=o(_,f,"z","y",c,l),w[M+1]=1-o(_,f,"y","z",c,r);break;case 1:_.set(-1,0,0),w[M+0]=1-o(_,f,"z","y",c,l),w[M+1]=1-o(_,f,"y","z",c,r);break;case 2:_.set(0,1,0),w[M+0]=1-o(_,f,"x","z",c,s),w[M+1]=o(_,f,"z","x",c,l);break;case 3:_.set(0,-1,0),w[M+0]=1-o(_,f,"x","z",c,s),w[M+1]=1-o(_,f,"z","x",c,l);break;case 4:_.set(0,0,1),w[M+0]=1-o(_,f,"x","y",c,s),w[M+1]=1-o(_,f,"y","x",c,r);break;case 5:_.set(0,0,-1),w[M+0]=o(_,f,"x","y",c,s),w[M+1]=1-o(_,f,"y","x",c,r)}}return t}return d()(n)}(e)}(t.THREE);return class{constructor(t,e){e=Object.assign({},{showCollider:!1,startPosition:[0,0,0],playerMoveSpeed:10,gravity:-30,jumpHeight:10,cameraFollowPlayer:!0,firstPersonView:!1,resetHeight:-25,limitDistance:20},e),this._viewer=t,this._initInner(),this._initByOuter(e),this._initColliderAndPlayer(e.url,e.showCollision),this._initEvent()}update(){const t=Math.min(this._clock.getDelta(),.1);if(this._cameraFollowPlayer?this._firstPersonView?this._viewer.configRestrict({maxVAngle:180,minDistance:1e-4,maxDistance:1e-4}):this._viewer.configRestrict({maxVAngle:90,minDistance:1,maxDistance:this._limitDistance}):this._viewer.configRestrict({maxVAngle:90,minDistance:1,maxDistance:1/0}),this._collider&&this._player)for(let e=0;e<this._physicsSteps;e++)this._updatePlayer(t/this._physicsSteps)}dispose(){window.removeEventListener("keydown",this._keyDownEventCallback),window.removeEventListener("keyup",this._keyUpEventCallback),this._keyDownEventCallback=null,this._keyUpEventCallback=null}_initInner(){this._clock=new e.Clock,this._playerIsOnGround=!1,this._fwdPressed=!1,this._bkdPressed=!1,this._lftPressed=!1,this._rgtPressed=!1,this._playerVelocity=new e.Vector3,this._upVector=new e.Vector3(0,1,0),this._tempVector=new e.Vector3,this._tempVector2=new e.Vector3,this._tempBox=new e.Box3,this._tempMat=new e.Matrix4,this._tempSegment=new e.Line3,this._physicsSteps=5}_initByOuter(t){this._playerMoveSpeed=t.playerMoveSpeed>0?t.playerMoveSpeed:10,this._gravity=t.gravity<0?t.gravity:-30,this._jumpHeight=t.jumpHeight>=0?t.jumpHeight:10,this._cameraFollowPlayer=t.cameraFollowPlayer,this._firstPersonView=t.firstPersonView,this._startPosition=t.startPosition,this._resetHeight=t.resetHeight,this._limitDistance=t.limitDistance>1?t.limitDistance:20}_initColliderAndPlayer(t,e){i.getGLTFLoader().load(t,t=>{this._createCollider(t.scene,e),this._createPlayer()},t=>{},t=>{throw new Error("模型加载错误")})}_createCollider(t,i){if(!(1===t.children.length&&t.children[0]instanceof e.Mesh))throw new Error("碰撞体模型不合法");{const o=t.children[0];o.geometry.boundsTree=new n(o.geometry,{lazyGeneration:!1}),this._collider=new e.Mesh(o.geometry),this._collider.position.copy(o.position),this._collider.rotation.copy(o.rotation),this._collider.scale.copy(o.scale);if(this._viewer.scene.add(this._collider),i){const t=this._collider.material;t.wireframe=!0,t.opacity=.5,t.transparent=!0}else this._collider.visible=!0,this._collider.material.visible=!1}}_createPlayer(){this._player=new e.Mesh(new o(1,2,1,10,.5),new e.MeshStandardMaterial),this._player.geometry.translate(0,-.5,0),this._player.capsuleInfo={radius:.5,segment:new e.Line3(new e.Vector3,new e.Vector3(0,-1,0))},this._player.position.fromArray(this._startPosition);this._viewer.scene.add(this._player),this._reset()}_updatePlayer(t){this._playerVelocity.y+=this._playerIsOnGround?0:t*this._gravity,this._player.position.addScaledVector(this._playerVelocity,t);const e=this._viewer.controls.orbitControl.getAzimuthalAngle();this._fwdPressed&&(this._tempVector.set(0,0,-1).applyAxisAngle(this._upVector,e),this._player.position.addScaledVector(this._tempVector,this._playerMoveSpeed*t)),this._bkdPressed&&(this._tempVector.set(0,0,1).applyAxisAngle(this._upVector,e),this._player.position.addScaledVector(this._tempVector,this._playerMoveSpeed*t)),this._lftPressed&&(this._tempVector.set(-1,0,0).applyAxisAngle(this._upVector,e),this._player.position.addScaledVector(this._tempVector,this._playerMoveSpeed*t)),this._rgtPressed&&(this._tempVector.set(1,0,0).applyAxisAngle(this._upVector,e),this._player.position.addScaledVector(this._tempVector,this._playerMoveSpeed*t)),this._player.updateMatrixWorld();const i=this._player.capsuleInfo;this._tempBox.makeEmpty(),this._tempMat.copy(this._collider.matrixWorld).invert(),this._tempSegment.copy(i.segment),this._tempSegment.start.applyMatrix4(this._player.matrixWorld).applyMatrix4(this._tempMat),this._tempSegment.end.applyMatrix4(this._player.matrixWorld).applyMatrix4(this._tempMat),this._tempBox.expandByPoint(this._tempSegment.start),this._tempBox.expandByPoint(this._tempSegment.end),this._tempBox.min.addScalar(-i.radius),this._tempBox.max.addScalar(i.radius),this._collider.geometry.boundsTree.shapecast({intersectsBounds:t=>t.intersectsBox(this._tempBox),intersectsTriangle:t=>{const e=this._tempVector,n=this._tempVector2,o=t.closestPointToSegment(this._tempSegment,e,n);if(o<i.radius){const t=i.radius-o,s=n.sub(e).normalize();this._tempSegment.start.addScaledVector(s,t),this._tempSegment.end.addScaledVector(s,t)}}});const n=this._tempVector;n.copy(this._tempSegment.start).applyMatrix4(this._collider.matrixWorld);const o=this._tempVector2;o.subVectors(n,this._player.position),this._playerIsOnGround=o.y>Math.abs(t*this._playerVelocity.y*.25);const s=Math.max(0,o.length()-1e-5);o.normalize().multiplyScalar(s),this._player.position.add(o),this._playerIsOnGround?this._playerVelocity.set(0,0,0):(o.normalize(),this._playerVelocity.addScaledVector(o,-o.dot(this._playerVelocity))),this._cameraFollowPlayer&&(this._viewer.camera.object3d.position.sub(this._viewer.controls.orbitControl.target),this._viewer.controls.orbitControl.target.copy(this._player.position),this._viewer.camera.object3d.position.add(this._player.position)),this._player.position.y<this._resetHeight&&this._reset()}_reset(){this._playerVelocity.set(0,0,0),this._player.position.fromArray(this._startPosition),this._viewer.camera.object3d.position.sub(this._viewer.controls.orbitControl.target),this._viewer.controls.orbitControl.target.copy(this._player.position),this._viewer.camera.object3d.position.add(this._player.position),this._viewer.controls.orbitControl.update()}_initEvent(){this._keyDownEventCallback=t=>{switch(t.code){case"KeyW":this._fwdPressed=!0;break;case"KeyS":this._bkdPressed=!0;break;case"KeyD":this._rgtPressed=!0;break;case"KeyA":this._lftPressed=!0;break;case"Space":this._playerIsOnGround&&(this._playerVelocity.y+=this._jumpHeight)}},this._keyUpEventCallback=t=>{switch(t.code){case"KeyW":this._fwdPressed=!1;break;case"KeyS":this._bkdPressed=!1;break;case"KeyD":this._rgtPressed=!1;break;case"KeyA":this._lftPressed=!1}},window.addEventListener("keydown",this._keyDownEventCallback),window.addEventListener("keyup",this._keyUpEventCallback)}}};class Q extends n.a{constructor(t){super(t),this.engineVersion="3.0.1",this.version="0.01"}bvhPlayerControls(t,e){const{BaseTool:i}=n.a.easy3DAPI;if(i.Validator.isValidObject(e)){let i=X(n.a.easy3DAPI);t.controls.bvhPlayerControl=new i(t,e)}}update(t){this.viewer.controls.bvhPlayerControl.update()}removeSelf(){this.viewer.controls.bvhPlayerControl.dispose()}static create(t){return Q.instance||(Q.instance=new Q(t)),Q.instance}}Q.pluginName="BVHPlayerControls",Q.instance=null;var Y=Q;class K{static install(t){if(0===K.subPlugins.length)throw Error("插件安装失败，请检查");for(let e=K.subPlugins.length-1;e>=0;e--){K.subPlugins[e].install(t,"UtilPlugins")}}}if(K.subPlugins=[y,M,C,D,E,T,Y],window&&window.easy3d&&"Plugins"in window.easy3d)for(let t=K.subPlugins.length-1;t>=0;t--){const e=K.subPlugins[t];n.a.install.call(e,window.easy3d,"UtilPlugins")}e.default=K}]);void 0===easy3d_plugins&&console.error("esm-webpack-plugin: nothing exported!");const _easy3d_plugins$UtilPlugins=easy3d_plugins.UtilPlugins;export default easy3d_plugins.default;export{_easy3d_plugins$UtilPlugins as UtilPlugins};